[{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\app.controller.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[228,231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[228,231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[315,318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[315,318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Controller, Get } from '@nestjs/common';\r\nimport { AppService } from './app.service';\r\n\r\n@Controller()\r\nexport class AppController {\r\n  constructor(private readonly appService: AppService) {}\r\n\r\n  @Get()\r\n  getHello(): any {\r\n    return this.appService.getHello();\r\n  }\r\n\r\n  @Get('health')\r\n  getHealth(): any {\r\n    return {\r\n      status: 'ok',\r\n      timestamp: new Date().toISOString(),\r\n      service: 'DeepDive Backend',\r\n      version: '1.0.0',\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\app.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\app.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[104,107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[104,107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable } from '@nestjs/common';\r\n\r\n@Injectable()\r\nexport class AppService {\r\n  getHello(): any {\r\n    return {\r\n      message: 'Welcome to DeepDive Engine API',\r\n      version: '1.0.0',\r\n      docs: '/api/v1',\r\n      health: '/api/v1/health',\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\auth\\auth.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\auth\\auth.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\auth\\auth.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\auth\\jwt.strategy.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[746,749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[746,749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":25,"column":16,"nodeType":"Property","messageId":"anyAssignment","endLine":25,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .sub on an `any` value.","line":25,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":25,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, UnauthorizedException } from '@nestjs/common';\r\nimport { PassportStrategy } from '@nestjs/passport';\r\nimport { ExtractJwt, Strategy } from 'passport-jwt';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { PrismaService } from '../common/prisma/prisma.service';\r\n\r\n/**\r\n * JWT 认证策略\r\n */\r\n@Injectable()\r\nexport class JwtStrategy extends PassportStrategy(Strategy) {\r\n  constructor(\r\n    configService: ConfigService,\r\n    private prisma: PrismaService,\r\n  ) {\r\n    super({\r\n      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\r\n      ignoreExpiration: false,\r\n      secretOrKey: configService.get<string>('JWT_SECRET', 'deepdive-secret-key-change-in-production'),\r\n    });\r\n  }\r\n\r\n  async validate(payload: any) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: payload.sub },\r\n      select: {\r\n        id: true,\r\n        email: true,\r\n        username: true,\r\n        createdAt: true,\r\n      },\r\n    });\r\n\r\n    if (!user) {\r\n      throw new UnauthorizedException('User not found');\r\n    }\r\n\r\n    return user;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\common\\mongodb\\mongodb.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\common\\mongodb\\mongodb.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1547,1550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1547,1550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":61,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":61,"endColumn":11},{"ruleId":"@typescript-eslint/restrict-template-expressions","severity":1,"message":"Invalid type \"ObjectId\" of template literal expression.","line":68,"column":63,"nodeType":"MemberExpression","messageId":"invalidType","endLine":68,"endColumn":80},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2190,2193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2190,2193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2401,2404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2401,2404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2665,2668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2665,2668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2895,2898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2895,2898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3018,3021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3018,3021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":108,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":108,"endColumn":11},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .resourceId on an `any` value.","line":113,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":113,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":118,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":118,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3921,3924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3921,3924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":151,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":151,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, OnModuleInit, OnModuleDestroy, Logger } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { MongoClient, Db, Collection, ObjectId } from 'mongodb';\r\n\r\n/**\r\n * MongoDB 服务\r\n * 用于存储原始采集数据（data_collection_raw_data 集合）\r\n */\r\n@Injectable()\r\nexport class MongoDBService implements OnModuleInit, OnModuleDestroy {\r\n  private client!: MongoClient;\r\n  private db!: Db;\r\n  private readonly logger = new Logger(MongoDBService.name);\r\n\r\n  constructor(private configService: ConfigService) {}\r\n\r\n  async onModuleInit() {\r\n    const mongoUrl = this.configService.get<string>('MONGO_URL');\r\n\r\n    if (!mongoUrl) {\r\n      throw new Error('MONGO_URL is not configured');\r\n    }\r\n\r\n    try {\r\n      this.client = new MongoClient(mongoUrl);\r\n      await this.client.connect();\r\n      this.db = this.client.db();\r\n      this.logger.log('✅ MongoDB connected successfully');\r\n    } catch (error) {\r\n      this.logger.error('❌ MongoDB connection failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async onModuleDestroy() {\r\n    if (this.client) {\r\n      await this.client.close();\r\n      this.logger.log('MongoDB connection closed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取原始数据集合\r\n   */\r\n  getRawDataCollection(): Collection {\r\n    return this.db.collection('data_collection_raw_data');\r\n  }\r\n\r\n  /**\r\n   * 插入原始数据（完整数据存储）\r\n   * @param source 数据源类型（arxiv, github, hackernews 等）\r\n   * @param data 完整的原始数据对象\r\n   * @param resourceId 可选的资源ID（用于建立反向引用）\r\n   * @returns MongoDB _id\r\n   */\r\n  async insertRawData(source: string, data: any, resourceId?: string): Promise<string> {\r\n    const collection = this.getRawDataCollection();\r\n\r\n    const document = {\r\n      source, // 数据源\r\n      data, // 完整原始数据（JSON 格式）\r\n      resourceId: resourceId ?? null, // ⚠️ 关键：反向引用到PostgreSQL resource\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n    };\r\n\r\n    const result = await collection.insertOne(document);\r\n    this.logger.log(`Inserted raw data from ${source}, _id: ${result.insertedId}${resourceId ? `, resourceId: ${resourceId}` : ''}`);\r\n\r\n    return result.insertedId.toString();\r\n  }\r\n\r\n  /**\r\n   * 根据 ID 获取原始数据\r\n   */\r\n  async getRawDataById(id: string): Promise<any> {\r\n    const collection = this.getRawDataCollection();\r\n    return collection.findOne({ _id: new ObjectId(id) });\r\n  }\r\n\r\n  /**\r\n   * 根据 ID 获取原始数据（别名方法）\r\n   */\r\n  async findRawDataById(id: string): Promise<any> {\r\n    return this.getRawDataById(id);\r\n  }\r\n\r\n  /**\r\n   * 根据数据源和外部 ID 查找原始数据（用于去重）\r\n   * @param source 数据源\r\n   * @param externalId 外部ID（如 arXiv ID, GitHub repo full_name 等）\r\n   */\r\n  async findRawDataByExternalId(source: string, externalId: string): Promise<any> {\r\n    const collection = this.getRawDataCollection();\r\n    return collection.findOne({\r\n      source,\r\n      'data.externalId': externalId,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 更新原始数据\r\n   */\r\n  async updateRawData(id: string, data: any, resourceId?: string): Promise<void> {\r\n    const collection = this.getRawDataCollection();\r\n\r\n    const updateFields: any = {\r\n      data,\r\n      updatedAt: new Date(),\r\n    };\r\n\r\n    if (resourceId) {\r\n      updateFields.resourceId = resourceId;\r\n    }\r\n\r\n    await collection.updateOne(\r\n      { _id: new ObjectId(id) },\r\n      { $set: updateFields },\r\n    );\r\n\r\n    this.logger.log(`Updated raw data _id: ${id}${resourceId ? `, resourceId: ${resourceId}` : ''}`);\r\n  }\r\n\r\n  /**\r\n   * 添加 resourceId 引用到已存在的原始数据\r\n   */\r\n  async linkResourceToRawData(rawDataId: string, resourceId: string): Promise<void> {\r\n    const collection = this.getRawDataCollection();\r\n\r\n    await collection.updateOne(\r\n      { _id: new ObjectId(rawDataId) },\r\n      {\r\n        $set: {\r\n          resourceId,\r\n          updatedAt: new Date(),\r\n        },\r\n      },\r\n    );\r\n\r\n    this.logger.log(`Linked resource ${resourceId} to raw data ${rawDataId}`);\r\n  }\r\n\r\n  /**\r\n   * 批量插入原始数据\r\n   */\r\n  async insertManyRawData(source: string, dataArray: any[]): Promise<string[]> {\r\n    const collection = this.getRawDataCollection();\r\n\r\n    const documents = dataArray.map(data => ({\r\n      source,\r\n      data,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n    }));\r\n\r\n    const result = await collection.insertMany(documents);\r\n    const ids = Object.values(result.insertedIds).map(id => id.toString());\r\n\r\n    this.logger.log(`Inserted ${ids.length} raw data items from ${source}`);\r\n\r\n    return ids;\r\n  }\r\n\r\n  /**\r\n   * 获取指定数据源的数据数量\r\n   */\r\n  async countBySource(source: string): Promise<number> {\r\n    const collection = this.getRawDataCollection();\r\n    return collection.countDocuments({ source });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\common\\neo4j\\neo4j.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\common\\neo4j\\neo4j.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1414,1417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1414,1417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1428,1431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1428,1431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1745,1748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1745,1748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1759,1762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1759,1762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":63,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":63,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":63,"column":45,"nodeType":"Property","messageId":"anyAssignment","endLine":63,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":64,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":64,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access [0] on an `any` value.","line":64,"column":19,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":64,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2133,2136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2133,2136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2152,2155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2152,2155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":84,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":84,"endColumn":90},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":84,"column":59,"nodeType":"Property","messageId":"anyAssignment","endLine":84,"endColumn":87},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":85,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":85,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access [0] on an `any` value.","line":85,"column":19,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":85,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2551,2554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2551,2554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2565,2568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2565,2568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":97,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":97,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":97,"column":45,"nodeType":"Property","messageId":"anyAssignment","endLine":97,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":98,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":98,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access [0] on an `any` value.","line":98,"column":19,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":98,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2860,2863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2860,2863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of type `Promise<any>` from function with return type `Promise<any[]>`.","line":109,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":109,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":22,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, OnModuleInit, OnModuleDestroy, Logger } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { getErrorMessage } from '../utils/error.utils';\r\nimport neo4j, { Driver, Session } from 'neo4j-driver';\r\n\r\n/**\r\n * Neo4j 数据库服务\r\n */\r\n@Injectable()\r\nexport class Neo4jService implements OnModuleInit, OnModuleDestroy {\r\n  private readonly logger = new Logger(Neo4jService.name);\r\n  private driver!: Driver;\r\n\r\n  constructor(private configService: ConfigService) {}\r\n\r\n  async onModuleInit() {\r\n    const uri = this.configService.get<string>('NEO4J_URI', 'bolt://localhost:7687');\r\n    const username = this.configService.get<string>('NEO4J_USERNAME', 'neo4j');\r\n    const password = this.configService.get<string>('NEO4J_PASSWORD', 'password');\r\n\r\n    try {\r\n      this.driver = neo4j.driver(uri, neo4j.auth.basic(username, password));\r\n      await this.driver.verifyConnectivity();\r\n      this.logger.log('✅ Neo4j connected successfully');\r\n    } catch (error) {\r\n      this.logger.error('❌ Neo4j connection failed:', getErrorMessage(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async onModuleDestroy() {\r\n    if (this.driver) {\r\n      await this.driver.close();\r\n      this.logger.log('Neo4j connection closed');\r\n    }\r\n  }\r\n\r\n  getSession(): Session {\r\n    return this.driver.session();\r\n  }\r\n\r\n  /**\r\n   * 执行 Cypher 查询\r\n   */\r\n  async run(cypher: string, parameters?: any): Promise<any> {\r\n    const session = this.getSession();\r\n    try {\r\n      const result = await session.run(cypher, parameters);\r\n      return result.records.map((record) => record.toObject());\r\n    } finally {\r\n      await session.close();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建节点\r\n   */\r\n  async createNode(label: string, properties: any): Promise<any> {\r\n    const cypher = `\r\n      CREATE (n:${label} $properties)\r\n      RETURN n\r\n    `;\r\n    const result = await this.run(cypher, { properties });\r\n    return result[0]?.n;\r\n  }\r\n\r\n  /**\r\n   * 创建关系\r\n   */\r\n  async createRelationship(\r\n    fromLabel: string,\r\n    fromId: string,\r\n    toLabel: string,\r\n    toId: string,\r\n    relationshipType: string,\r\n    properties?: any,\r\n  ): Promise<any> {\r\n    const cypher = `\r\n      MATCH (from:${fromLabel} {id: $fromId})\r\n      MATCH (to:${toLabel} {id: $toId})\r\n      CREATE (from)-[r:${relationshipType} $properties]->(to)\r\n      RETURN r\r\n    `;\r\n    const result = await this.run(cypher, { fromId, toId, properties: properties || {} });\r\n    return result[0]?.r;\r\n  }\r\n\r\n  /**\r\n   * 查找节点\r\n   */\r\n  async findNode(label: string, properties: any): Promise<any> {\r\n    const cypher = `\r\n      MATCH (n:${label} $properties)\r\n      RETURN n\r\n      LIMIT 1\r\n    `;\r\n    const result = await this.run(cypher, { properties });\r\n    return result[0]?.n;\r\n  }\r\n\r\n  /**\r\n   * 获取节点的所有关系\r\n   */\r\n  async getNodeRelationships(label: string, id: string): Promise<any[]> {\r\n    const cypher = `\r\n      MATCH (n:${label} {id: $id})-[r]-(m)\r\n      RETURN type(r) as type, m, r\r\n    `;\r\n    return this.run(cypher, { id });\r\n  }\r\n\r\n  /**\r\n   * 删除节点\r\n   */\r\n  async deleteNode(label: string, id: string): Promise<void> {\r\n    const cypher = `\r\n      MATCH (n:${label} {id: $id})\r\n      DETACH DELETE n\r\n    `;\r\n    await this.run(cypher, { id });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\common\\prisma\\prisma.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\common\\prisma\\prisma.service.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":8,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":8,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[292,338],"text":""},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, OnModuleInit, OnModuleDestroy } from '@nestjs/common';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\n@Injectable()\r\nexport class PrismaService extends PrismaClient implements OnModuleInit, OnModuleDestroy {\r\n  async onModuleInit() {\r\n    await this.$connect();\r\n    console.log('✅ Prisma connected to database');\r\n  }\r\n\r\n  async onModuleDestroy() {\r\n    await this.$disconnect();\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\common\\utils\\error.utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\crawler\\arxiv.service.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":35,"column":93,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":35,"endColumn":95,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1162,1164],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":54,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":54,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":58,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":58,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `convertableToString`.","line":58,"column":54,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":58,"endColumn":61},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":1,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":60,"column":11,"nodeType":null,"messageId":"preferOptionalChain","endLine":60,"endColumn":45,"fix":{"range":[1804,1838],"text":"!result.feed?.entry"}},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .feed on an `any` value.","line":60,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":60,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .feed on an `any` value.","line":60,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":60,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":66,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":66,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .feed on an `any` value.","line":66,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":66,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .feed on an `any` value.","line":66,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":66,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .feed on an `any` value.","line":66,"column":86,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":66,"endColumn":90},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":68,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":68,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .title on an `any` value.","line":77,"column":63,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":77,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":81,"column":73,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":81,"endColumn":79},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2767,2770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2767,2770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":94,"column":41,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":94,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":94,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":94,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":97,"column":66,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":97,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":102,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":102,"endColumn":89},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":110,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":110,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":118,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":118,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":121,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":121,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4259,4262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4259,4262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4282,4285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4282,4285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .author on an `any` value.","line":146,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":146,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .category on an `any` value.","line":149,"column":51,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":149,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .link on an `any` value.","line":152,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":152,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":160,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":160,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":160,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":160,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":161,"column":35,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":161,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .title on an `any` value.","line":161,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":161,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":162,"column":37,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":162,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .summary on an `any` value.","line":162,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":162,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":168,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":168,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .published on an `any` value.","line":168,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":168,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":169,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":169,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .updated on an `any` value.","line":169,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":169,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":173,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":173,"endColumn":95},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access ['arxiv:primary_category'] on an `any` value.","line":173,"column":30,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":173,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .term on an `any` value.","line":173,"column":83,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":173,"endColumn":87},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":177,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":177,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":177,"column":15,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":177,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .title on an `any` value.","line":177,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":177,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .href on an `any` value.","line":177,"column":53,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":177,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":178,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":178,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":178,"column":20,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":178,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":178,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":178,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":181,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":181,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access ['arxiv:doi'] on an `any` value.","line":181,"column":18,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":181,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":184,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":184,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access ['arxiv:comment'] on an `any` value.","line":184,"column":22,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":184,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":187,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":187,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access ['arxiv:journal_ref'] on an `any` value.","line":187,"column":25,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":187,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":190,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":190,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5657,5660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5657,5660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5663,5666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5663,5666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":206,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":206,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .name on an `any` value.","line":206,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":206,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":207,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":207,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access ['arxiv:affiliation'] on an `any` value.","line":207,"column":27,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":207,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6011,6014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6011,6014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6017,6020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6017,6020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":220,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":220,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .$ on an `any` value.","line":220,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":220,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":221,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":221,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .$ on an `any` value.","line":221,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":221,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6318,6321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6318,6321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6324,6327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6324,6327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":234,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":234,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .$ on an `any` value.","line":234,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":234,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":235,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":235,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .$ on an `any` value.","line":235,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":235,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":236,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":236,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .$ on an `any` value.","line":236,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":236,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":237,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":237,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .$ on an `any` value.","line":237,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":237,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":246,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6717,6720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6717,6720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":246,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6742,6745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6742,6745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":251,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":251,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .title on an `any` value.","line":251,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":251,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":252,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":252,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .summary on an `any` value.","line":252,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":252,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":253,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":253,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .abstractUrl on an `any` value.","line":253,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":253,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":254,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":254,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .pdfUrl on an `any` value.","line":254,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":254,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":257,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":257,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .authors on an `any` value.","line":257,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":257,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string | number | Date`.","line":260,"column":29,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":260,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .published on an `any` value.","line":260,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":260,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":263,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":263,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .primaryCategory on an `any` value.","line":263,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":263,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":264,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":264,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":264,"column":19,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":264,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .categories on an `any` value.","line":264,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":264,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":264,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":264,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7169,7172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7169,7172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":264,"column":54,"nodeType":"MemberExpression","messageId":"unsafeReturn","endLine":264,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .term on an `any` value.","line":264,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":264,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":265,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":265,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":265,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":265,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .categories on an `any` value.","line":265,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":265,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7226,7229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7226,7229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":265,"column":48,"nodeType":"MemberExpression","messageId":"unsafeReturn","endLine":265,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .term on an `any` value.","line":265,"column":50,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":265,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":269,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":269,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .externalId on an `any` value.","line":269,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":269,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":270,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":270,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .doi on an `any` value.","line":270,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":270,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":271,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":271,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .comment on an `any` value.","line":271,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":271,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":272,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":272,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .journalRef on an `any` value.","line":272,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":272,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":273,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":273,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .updated on an `any` value.","line":273,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":273,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":301,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":301,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":304,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":304,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `convertableToString`.","line":304,"column":54,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":304,"endColumn":61},{"ruleId":"@typescript-eslint/prefer-optional-chain","severity":1,"message":"Prefer using an optional chain expression instead, as it's more concise and easier to read.","line":306,"column":11,"nodeType":null,"messageId":"preferOptionalChain","endLine":306,"endColumn":45,"fix":{"range":[8232,8266],"text":"!result.feed?.entry"}},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .feed on an `any` value.","line":306,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":306,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .feed on an `any` value.","line":306,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":306,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":311,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":311,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .feed on an `any` value.","line":311,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":311,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .feed on an `any` value.","line":311,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":311,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .feed on an `any` value.","line":311,"column":86,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":311,"endColumn":90}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":124,"fixableErrorCount":0,"fixableWarningCount":2,"source":"import { Injectable, Logger } from '@nestjs/common';\r\nimport { PrismaService } from '../common/prisma/prisma.service';\r\nimport { MongoDBService } from '../common/mongodb/mongodb.service';\r\nimport { DeduplicationService } from './deduplication.service';\r\nimport { getErrorStack } from '../common/utils/error.utils';\r\nimport axios from 'axios';\r\nimport * as xml2js from 'xml2js';\r\n\r\n/**\r\n * arXiv 论文采集器\r\n *\r\n * 关键功能：\r\n * 1. 存储完整信息到 MongoDB raw_data 集合\r\n * 2. 建立 raw_data ↔ resource 的引用关系\r\n * 3. 实现去重逻辑（基于 arXiv ID）\r\n * 4. 解析所有字段（标题、作者、摘要、分类、PDF链接等）\r\n */\r\n@Injectable()\r\nexport class ArxivService {\r\n  private readonly logger = new Logger(ArxivService.name);\r\n  private readonly ARXIV_API_URL = 'http://export.arxiv.org/api/query';\r\n\r\n  constructor(\r\n    private prisma: PrismaService,\r\n    private mongodb: MongoDBService,\r\n    private dedup: DeduplicationService,\r\n  ) {}\r\n\r\n  /**\r\n   * 采集最新的 arXiv 论文\r\n   * @param maxResults 最大结果数\r\n   * @param category 分类（可选）如 'cs.AI', 'cs.LG' 等\r\n   */\r\n  async fetchLatestPapers(maxResults = 10, category?: string): Promise<number> {\r\n    this.logger.log(`Fetching latest arXiv papers (max: ${maxResults}, category: ${category || 'all'})`);\r\n\r\n    try {\r\n      // 构建查询参数\r\n      let searchQuery = 'all';\r\n      if (category) {\r\n        searchQuery = `cat:${category}`;\r\n      }\r\n\r\n      const params = {\r\n        search_query: searchQuery,\r\n        start: 0,\r\n        max_results: maxResults,\r\n        sortBy: 'submittedDate',\r\n        sortOrder: 'descending',\r\n      };\r\n\r\n      // 调用 arXiv API\r\n      const response = await axios.get(this.ARXIV_API_URL, { params });\r\n      const xmlData = response.data;\r\n\r\n      // 解析 XML\r\n      const parser = new xml2js.Parser({ explicitArray: false });\r\n      const result = await parser.parseStringPromise(xmlData);\r\n\r\n      if (!result.feed || !result.feed.entry) {\r\n        this.logger.warn('No entries found in arXiv response');\r\n        return 0;\r\n      }\r\n\r\n      // 处理单个或多个 entry\r\n      const entries = Array.isArray(result.feed.entry) ? result.feed.entry : [result.feed.entry];\r\n\r\n      this.logger.log(`Parsed ${entries.length} papers from arXiv`);\r\n\r\n      // 处理每个论文\r\n      let successCount = 0;\r\n      for (const entry of entries) {\r\n        try {\r\n          await this.processPaper(entry);\r\n          successCount++;\r\n        } catch (error) {\r\n          this.logger.error(`Failed to process paper: ${entry.title}`, getErrorStack(error));\r\n        }\r\n      }\r\n\r\n      this.logger.log(`Successfully processed ${successCount}/${entries.length} papers`);\r\n      return successCount;\r\n    } catch (error) {\r\n      this.logger.error('Failed to fetch arXiv papers', getErrorStack(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 处理单个论文\r\n   */\r\n  private async processPaper(entry: any): Promise<void> {\r\n    // 提取 arXiv ID（用于去重）\r\n    const arxivId = this.extractArxivId(entry.id);\r\n\r\n    if (!arxivId) {\r\n      this.logger.warn(`Failed to extract arXiv ID from: ${entry.id}`);\r\n      return;\r\n    }\r\n\r\n    // 检查是否已存在（去重）\r\n    const existingRawData = await this.mongodb.findRawDataByExternalId('arxiv', arxivId);\r\n\r\n    if (existingRawData) {\r\n      this.logger.debug(`Paper already exists: ${arxivId}`);\r\n      return;\r\n    }\r\n\r\n    // 解析完整的原始数据\r\n    const rawData = this.parseRawData(entry, arxivId);\r\n\r\n    // 1. 存储完整原始数据到 MongoDB\r\n    const rawDataId = await this.mongodb.insertRawData('arxiv', rawData);\r\n\r\n    this.logger.log(`Stored raw data in MongoDB: ${arxivId} -> ${rawDataId}`);\r\n\r\n    // 2. 提取结构化数据并存储到 PostgreSQL\r\n    const resourceData = this.extractResourceData(rawData, rawDataId);\r\n\r\n    const resource = await this.prisma.resource.create({\r\n      data: resourceData,\r\n    });\r\n\r\n    this.logger.log(`Created resource in PostgreSQL with rawDataId: ${rawDataId}`);\r\n\r\n    // 3. ⚠️ 关键：建立反向引用（MongoDB → PostgreSQL）\r\n    await this.mongodb.linkResourceToRawData(rawDataId, resource.id);\r\n  }\r\n\r\n  /**\r\n   * 提取 arXiv ID\r\n   */\r\n  private extractArxivId(url: string): string | null {\r\n    // arXiv ID 格式: http://arxiv.org/abs/2311.12345v1\r\n    const match = url.match(/arxiv\\.org\\/abs\\/(\\d+\\.\\d+(?:v\\d+)?)/);\r\n    return match ? match[1] : null;\r\n  }\r\n\r\n  /**\r\n   * 解析完整的原始数据（存储到 MongoDB）\r\n   *\r\n   * ⚠️ 关键：存储所有字段，不仅仅是基本信息！\r\n   */\r\n  private parseRawData(entry: any, arxivId: string): any {\r\n    // 解析作者\r\n    const authors = this.parseAuthors(entry.author);\r\n\r\n    // 解析分类\r\n    const categories = this.parseCategories(entry.category);\r\n\r\n    // 解析链接\r\n    const links = this.parseLinks(entry.link);\r\n\r\n    // 完整的原始数据对象\r\n    return {\r\n      // 外部 ID（用于去重）\r\n      externalId: arxivId,\r\n\r\n      // 基础信息\r\n      id: entry.id,\r\n      title: this.dedup.cleanText(entry.title),\r\n      summary: this.dedup.cleanText(entry.summary),\r\n\r\n      // 作者信息（完整）\r\n      authors: authors,\r\n\r\n      // 时间信息\r\n      published: entry.published,\r\n      updated: entry.updated,\r\n\r\n      // 分类信息（完整）\r\n      categories: categories,\r\n      primaryCategory: entry['arxiv:primary_category']?.$?.term || categories[0]?.term || null,\r\n\r\n      // 链接信息（完整）\r\n      links: links,\r\n      pdfUrl: links.find((l) => l.title === 'pdf')?.href?.replace('http://', 'https://') || null,\r\n      abstractUrl: entry.id?.replace('http://', 'https://'),\r\n\r\n      // DOI（如果有）\r\n      doi: entry['arxiv:doi']?.$?.['doi'] || null,\r\n\r\n      // 评论（如果有）\r\n      comment: entry['arxiv:comment']?.$?.['xmlns:arxiv'] || null,\r\n\r\n      // 期刊引用（如果有）\r\n      journalRef: entry['arxiv:journal_ref']?.$?.['xmlns:arxiv'] || null,\r\n\r\n      // 原始 entry（完整保存，以防未来需要）\r\n      _raw: entry,\r\n\r\n      // 采集时间\r\n      fetchedAt: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 解析作者列表（完整信息）\r\n   */\r\n  private parseAuthors(authorData: any): any[] {\r\n    if (!authorData) return [];\r\n\r\n    const authors = Array.isArray(authorData) ? authorData : [authorData];\r\n\r\n    return authors.map((author) => ({\r\n      name: author.name,\r\n      affiliation: author['arxiv:affiliation']?.$?.['xmlns:arxiv'] || null,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * 解析分类列表\r\n   */\r\n  private parseCategories(categoryData: any): any[] {\r\n    if (!categoryData) return [];\r\n\r\n    const categories = Array.isArray(categoryData) ? categoryData : [categoryData];\r\n\r\n    return categories.map((cat) => ({\r\n      term: cat.$.term,\r\n      scheme: cat.$.scheme,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * 解析链接列表\r\n   */\r\n  private parseLinks(linkData: any): any[] {\r\n    if (!linkData) return [];\r\n\r\n    const links = Array.isArray(linkData) ? linkData : [linkData];\r\n\r\n    return links.map((link) => ({\r\n      href: link.$.href,\r\n      rel: link.$.rel,\r\n      type: link.$.type,\r\n      title: link.$.title,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * 从原始数据提取结构化数据（存储到 PostgreSQL）\r\n   *\r\n   * ⚠️ 关键：建立 rawDataId 引用关系！\r\n   */\r\n  private extractResourceData(rawData: any, rawDataId: string): any {\r\n    return {\r\n      type: 'PAPER',\r\n\r\n      // 基础信息\r\n      title: rawData.title,\r\n      abstract: rawData.summary,\r\n      sourceUrl: rawData.abstractUrl,\r\n      pdfUrl: rawData.pdfUrl,\r\n\r\n      // 作者信息（JSON 格式）\r\n      authors: rawData.authors,\r\n\r\n      // 发布时间\r\n      publishedAt: new Date(rawData.published),\r\n\r\n      // 分类\r\n      primaryCategory: rawData.primaryCategory,\r\n      categories: rawData.categories.map((c: any) => c.term),\r\n      tags: rawData.categories.map((c: any) => c.term),\r\n\r\n      // 元数据\r\n      metadata: {\r\n        arxivId: rawData.externalId,\r\n        doi: rawData.doi,\r\n        comment: rawData.comment,\r\n        journalRef: rawData.journalRef,\r\n        updated: rawData.updated,\r\n      },\r\n\r\n      // ⚠️ 关键！MongoDB 原始数据引用\r\n      rawDataId: rawDataId,\r\n\r\n      // 初始评分\r\n      qualityScore: 0,\r\n      trendingScore: 0,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 搜索特定主题的论文\r\n   */\r\n  async searchPapers(query: string, maxResults = 10): Promise<number> {\r\n    this.logger.log(`Searching arXiv papers: \"${query}\"`);\r\n\r\n    try {\r\n      const params = {\r\n        search_query: `all:${query}`,\r\n        start: 0,\r\n        max_results: maxResults,\r\n        sortBy: 'relevance',\r\n        sortOrder: 'descending',\r\n      };\r\n\r\n      const response = await axios.get(this.ARXIV_API_URL, { params });\r\n      const xmlData = response.data;\r\n\r\n      const parser = new xml2js.Parser({ explicitArray: false });\r\n      const result = await parser.parseStringPromise(xmlData);\r\n\r\n      if (!result.feed || !result.feed.entry) {\r\n        this.logger.warn('No entries found');\r\n        return 0;\r\n      }\r\n\r\n      const entries = Array.isArray(result.feed.entry) ? result.feed.entry : [result.feed.entry];\r\n\r\n      let successCount = 0;\r\n      for (const entry of entries) {\r\n        try {\r\n          await this.processPaper(entry);\r\n          successCount++;\r\n        } catch (error) {\r\n          this.logger.error(`Failed to process paper`, getErrorStack(error));\r\n        }\r\n      }\r\n\r\n      return successCount;\r\n    } catch (error) {\r\n      this.logger.error('Search failed', getErrorStack(error));\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\crawler\\crawler.controller.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":39,"column":26,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":39,"endColumn":28,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1098,1100],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":75,"column":77,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":75,"endColumn":79,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1940,1942],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":77,"column":79,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":77,"endColumn":81,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2035,2037],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":84,"column":26,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":84,"endColumn":28,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2195,2197],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":85,"column":20,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":85,"endColumn":22,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2225,2227],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":184,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":184,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .message on an `any` value.","line":184,"column":51,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":184,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Controller, Post, Get, Query, Logger } from '@nestjs/common';\r\nimport { ArxivService } from './arxiv.service';\r\nimport { GithubService } from './github.service';\r\nimport { HackernewsService } from './hackernews.service';\r\n\r\n/**\r\n * 数据采集器控制器\r\n */\r\n@Controller('crawler')\r\nexport class CrawlerController {\r\n  private readonly logger = new Logger(CrawlerController.name);\r\n\r\n  constructor(\r\n    private arxivService: ArxivService,\r\n    private githubService: GithubService,\r\n    private hackernewsService: HackernewsService,\r\n  ) {}\r\n\r\n  /**\r\n   * 采集 arXiv 最新论文\r\n   */\r\n  @Post('arxiv/latest')\r\n  async fetchArxivLatest(\r\n    @Query('max') max?: string,\r\n    @Query('category') category?: string,\r\n  ) {\r\n    const maxResults = max ? parseInt(max, 10) : 10;\r\n\r\n    this.logger.log(`Triggering arXiv latest papers fetch (max: ${maxResults})`);\r\n\r\n    const count = await this.arxivService.fetchLatestPapers(maxResults, category);\r\n\r\n    return {\r\n      success: true,\r\n      source: 'arxiv',\r\n      action: 'fetch_latest',\r\n      processed: count,\r\n      maxResults,\r\n      category: category || 'all',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 搜索 arXiv 论文\r\n   */\r\n  @Post('arxiv/search')\r\n  async searchArxiv(@Query('q') query: string, @Query('max') max?: string) {\r\n    if (!query) {\r\n      return {\r\n        success: false,\r\n        error: 'Query parameter \"q\" is required',\r\n      };\r\n    }\r\n\r\n    const maxResults = max ? parseInt(max, 10) : 10;\r\n    const count = await this.arxivService.searchPapers(query, maxResults);\r\n\r\n    return {\r\n      success: true,\r\n      source: 'arxiv',\r\n      action: 'search',\r\n      query,\r\n      processed: count,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 采集 GitHub 趋势项目\r\n   */\r\n  @Post('github/trending')\r\n  async fetchGithubTrending(\r\n    @Query('language') language?: string,\r\n    @Query('since') since?: 'daily' | 'weekly' | 'monthly',\r\n  ) {\r\n    this.logger.log(`Triggering GitHub trending fetch (language: ${language || 'all'})`);\r\n\r\n    const count = await this.githubService.fetchTrendingRepos(language, since || 'daily');\r\n\r\n    return {\r\n      success: true,\r\n      source: 'github',\r\n      action: 'fetch_trending',\r\n      processed: count,\r\n      language: language || 'all',\r\n      since: since || 'daily',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 搜索 GitHub 项目\r\n   */\r\n  @Post('github/search')\r\n  async searchGithub(@Query('q') query: string, @Query('max') max?: string) {\r\n    if (!query) {\r\n      return {\r\n        success: false,\r\n        error: 'Query parameter \"q\" is required',\r\n      };\r\n    }\r\n\r\n    const maxResults = max ? parseInt(max, 10) : 10;\r\n    const count = await this.githubService.searchRepositories(query, maxResults);\r\n\r\n    return {\r\n      success: true,\r\n      source: 'github',\r\n      action: 'search',\r\n      query,\r\n      processed: count,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 采集 HackerNews 热门故事\r\n   */\r\n  @Post('hackernews/top')\r\n  async fetchHNTop(@Query('max') max?: string) {\r\n    const maxResults = max ? parseInt(max, 10) : 30;\r\n\r\n    this.logger.log(`Triggering HackerNews top stories fetch (max: ${maxResults})`);\r\n\r\n    const count = await this.hackernewsService.fetchTopStories(maxResults);\r\n\r\n    return {\r\n      success: true,\r\n      source: 'hackernews',\r\n      action: 'fetch_top',\r\n      processed: count,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 采集 HackerNews 最新故事\r\n   */\r\n  @Post('hackernews/new')\r\n  async fetchHNNew(@Query('max') max?: string) {\r\n    const maxResults = max ? parseInt(max, 10) : 30;\r\n    const count = await this.hackernewsService.fetchNewStories(maxResults);\r\n\r\n    return {\r\n      success: true,\r\n      source: 'hackernews',\r\n      action: 'fetch_new',\r\n      processed: count,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 采集 HackerNews 最佳故事\r\n   */\r\n  @Post('hackernews/best')\r\n  async fetchHNBest(@Query('max') max?: string) {\r\n    const maxResults = max ? parseInt(max, 10) : 30;\r\n    const count = await this.hackernewsService.fetchBestStories(maxResults);\r\n\r\n    return {\r\n      success: true,\r\n      source: 'hackernews',\r\n      action: 'fetch_best',\r\n      processed: count,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 一键采集所有数据源\r\n   */\r\n  @Post('fetch-all')\r\n  async fetchAll() {\r\n    this.logger.log('Triggering fetch for all data sources');\r\n\r\n    const results = await Promise.allSettled([\r\n      this.arxivService.fetchLatestPapers(10, 'cs.AI'),\r\n      this.githubService.fetchTrendingRepos('typescript', 'daily'),\r\n      this.hackernewsService.fetchTopStories(20),\r\n    ]);\r\n\r\n    return {\r\n      success: true,\r\n      action: 'fetch_all',\r\n      results: results.map((r, index) => ({\r\n        source: ['arxiv', 'github', 'hackernews'][index],\r\n        status: r.status,\r\n        processed: r.status === 'fulfilled' ? r.value : 0,\r\n        error: r.status === 'rejected' ? r.reason.message : null,\r\n      })),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 健康检查\r\n   */\r\n  @Get('health')\r\n  health() {\r\n    return {\r\n      status: 'ok',\r\n      service: 'Crawler',\r\n      sources: ['arxiv', 'github', 'hackernews'],\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\crawler\\crawler.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\crawler\\deduplication.service.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":23,"column":50,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":23,"endColumn":52,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[593,595],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of type any[][] to a variable of type number[][].","line":33,"column":11,"nodeType":"VariableDeclarator","messageId":"unsafeAssignment","endLine":35,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any[]` typed value.","line":35,"column":18,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":35,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, Logger } from '@nestjs/common';\r\nimport { createHash } from 'crypto';\r\n\r\n/**\r\n * 去重服务\r\n * 实现 URL 哈希去重和标题相似度检测\r\n */\r\n@Injectable()\r\nexport class DeduplicationService {\r\n  private readonly logger = new Logger(DeduplicationService.name);\r\n\r\n  /**\r\n   * 生成 URL 的 MD5 哈希\r\n   */\r\n  generateUrlHash(url: string): string {\r\n    return createHash('md5').update(url.trim().toLowerCase()).digest('hex');\r\n  }\r\n\r\n  /**\r\n   * 生成内容指纹（标题 + 关键字段）\r\n   */\r\n  generateContentFingerprint(title: string, additionalFields?: string[]): string {\r\n    const content = [title, ...(additionalFields || [])].join('|').trim().toLowerCase();\r\n    return createHash('md5').update(content).digest('hex');\r\n  }\r\n\r\n  /**\r\n   * 计算 Levenshtein 距离（字符串相似度）\r\n   */\r\n  private levenshteinDistance(str1: string, str2: string): number {\r\n    const m = str1.length;\r\n    const n = str2.length;\r\n    const dp: number[][] = Array(m + 1)\r\n      .fill(null)\r\n      .map(() => Array(n + 1).fill(0));\r\n\r\n    for (let i = 0; i <= m; i++) dp[i][0] = i;\r\n    for (let j = 0; j <= n; j++) dp[0][j] = j;\r\n\r\n    for (let i = 1; i <= m; i++) {\r\n      for (let j = 1; j <= n; j++) {\r\n        if (str1[i - 1] === str2[j - 1]) {\r\n          dp[i][j] = dp[i - 1][j - 1];\r\n        } else {\r\n          dp[i][j] = Math.min(dp[i - 1][j - 1], dp[i - 1][j], dp[i][j - 1]) + 1;\r\n        }\r\n      }\r\n    }\r\n\r\n    return dp[m][n];\r\n  }\r\n\r\n  /**\r\n   * 计算标题相似度（0-1，1 表示完全相同）\r\n   */\r\n  calculateTitleSimilarity(title1: string, title2: string): number {\r\n    const s1 = title1.toLowerCase().trim();\r\n    const s2 = title2.toLowerCase().trim();\r\n\r\n    if (s1 === s2) return 1.0;\r\n\r\n    const maxLen = Math.max(s1.length, s2.length);\r\n    if (maxLen === 0) return 1.0;\r\n\r\n    const distance = this.levenshteinDistance(s1, s2);\r\n    return 1 - distance / maxLen;\r\n  }\r\n\r\n  /**\r\n   * 判断两个标题是否相似（阈值 0.85）\r\n   */\r\n  areTitlesSimilar(title1: string, title2: string, threshold = 0.85): boolean {\r\n    const similarity = this.calculateTitleSimilarity(title1, title2);\r\n    return similarity >= threshold;\r\n  }\r\n\r\n  /**\r\n   * 规范化 URL（移除 query 参数、hash、trailing slash）\r\n   */\r\n  normalizeUrl(url: string): string {\r\n    try {\r\n      const urlObj = new URL(url);\r\n      // 移除 query 参数和 hash\r\n      urlObj.search = '';\r\n      urlObj.hash = '';\r\n      let normalized = urlObj.toString();\r\n      // 移除 trailing slash\r\n      if (normalized.endsWith('/')) {\r\n        normalized = normalized.slice(0, -1);\r\n      }\r\n      return normalized;\r\n    } catch (error) {\r\n      this.logger.warn(`Failed to normalize URL: ${url}`);\r\n      return url.trim().toLowerCase();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 提取域名\r\n   */\r\n  extractDomain(url: string): string | null {\r\n    try {\r\n      const urlObj = new URL(url);\r\n      return urlObj.hostname;\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量检测重复（返回重复项的索引）\r\n   */\r\n  detectDuplicatesInBatch(items: Array<{ url: string; title: string }>): number[] {\r\n    const duplicateIndices: number[] = [];\r\n    const seen = new Map<string, number>();\r\n\r\n    items.forEach((item, index) => {\r\n      const urlHash = this.generateUrlHash(this.normalizeUrl(item.url));\r\n\r\n      if (seen.has(urlHash)) {\r\n        duplicateIndices.push(index);\r\n        this.logger.debug(`Duplicate detected: ${item.title} (index ${index})`);\r\n      } else {\r\n        seen.set(urlHash, index);\r\n      }\r\n    });\r\n\r\n    return duplicateIndices;\r\n  }\r\n\r\n  /**\r\n   * 清理文本（移除多余空格、换行等）\r\n   */\r\n  cleanText(text: string): string {\r\n    if (!text) return '';\r\n    return text\r\n      .replace(/\\s+/g, ' ') // 多个空格替换为单个\r\n      .replace(/\\n+/g, ' ') // 换行替换为空格\r\n      .trim();\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\crawler\\github.service.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":64,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":66,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1019,1021],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":42,"column":75,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":42,"endColumn":77,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[1502,1504],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":63,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":63,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":66,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":66,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .items on an `any` value.","line":66,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":66,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":67,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":67,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .full_name on an `any` value.","line":75,"column":61,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":75,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":79,"column":71,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":79,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":103,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":103,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":106,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":106,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .items on an `any` value.","line":106,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":106,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3813,3816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3813,3816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":129,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":129,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .full_name on an `any` value.","line":129,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":129,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":132,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":132,"endColumn":95},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":132,"column":82,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":132,"endColumn":94},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":140,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":140,"endColumn":89},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":140,"column":61,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":140,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .owner on an `any` value.","line":140,"column":66,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":140,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":140,"column":79,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":140,"endColumn":88},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .name on an `any` value.","line":140,"column":84,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":140,"endColumn":88},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":143,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":143,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":143,"column":53,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":143,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":151,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":151,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":154,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":154,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5067,5070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5067,5070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":167,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":167,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":172,"column":70,"nodeType":"Property","messageId":"anyAssignment","endLine":172,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":174,"column":80,"nodeType":"Property","messageId":"anyAssignment","endLine":174,"endColumn":87},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":176,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":176,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":181,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":186,"endColumn":8},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5642,5645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5642,5645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":184,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":184,"endColumn":88},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":185,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":185,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":188,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":188,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":201,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":204,"endColumn":10},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":207,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":207,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6829,6832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6829,6832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6857,6860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6857,6860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":225,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":225,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":225,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":225,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":226,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":226,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .name on an `any` value.","line":226,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":226,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":227,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":227,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .full_name on an `any` value.","line":227,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":227,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":229,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":229,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .owner on an `any` value.","line":229,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":229,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":230,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":230,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .owner on an `any` value.","line":230,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":230,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":231,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":231,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .owner on an `any` value.","line":231,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":231,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":232,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":232,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .owner on an `any` value.","line":232,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":232,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":233,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":233,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .owner on an `any` value.","line":233,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":233,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":237,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":237,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .description on an `any` value.","line":237,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":237,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":238,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":238,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .readme on an `any` value.","line":238,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":238,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":241,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":241,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .html_url on an `any` value.","line":241,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":241,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":242,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":242,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .homepage on an `any` value.","line":242,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":242,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":243,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":243,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .clone_url on an `any` value.","line":243,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":243,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":244,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":244,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .git_url on an `any` value.","line":244,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":244,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":247,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":247,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .stargazers_count on an `any` value.","line":247,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":247,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":248,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":248,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .watchers_count on an `any` value.","line":248,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":248,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":249,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":249,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .forks_count on an `any` value.","line":249,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":249,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":250,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":250,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .open_issues_count on an `any` value.","line":250,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":250,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":253,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":253,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .language on an `any` value.","line":253,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":253,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":254,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":254,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .languages on an `any` value.","line":254,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":254,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":257,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":257,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .topics on an `any` value.","line":257,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":257,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .license on an `any` value.","line":260,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":260,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":262,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":262,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .license on an `any` value.","line":262,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":262,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":263,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":263,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .license on an `any` value.","line":263,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":263,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":264,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":264,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .license on an `any` value.","line":264,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":264,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":269,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":269,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .created_at on an `any` value.","line":269,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":269,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":270,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":270,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .updated_at on an `any` value.","line":270,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":270,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":271,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":271,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .pushed_at on an `any` value.","line":271,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":271,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":274,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":274,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .contributors on an `any` value.","line":274,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":274,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":277,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":277,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .size on an `any` value.","line":277,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":277,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":278,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":278,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .default_branch on an `any` value.","line":278,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":278,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":279,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":279,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .private on an `any` value.","line":279,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":279,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":280,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":280,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .fork on an `any` value.","line":280,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":280,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":281,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":281,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .archived on an `any` value.","line":281,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":281,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":282,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":282,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .is_template on an `any` value.","line":282,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":282,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":283,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":283,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .has_issues on an `any` value.","line":283,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":283,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":284,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":284,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .has_projects on an `any` value.","line":284,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":284,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":285,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":285,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .has_wiki on an `any` value.","line":285,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":285,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":286,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":286,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .has_pages on an `any` value.","line":286,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":286,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":287,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":287,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .has_downloads on an `any` value.","line":287,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":287,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":290,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":290,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9010,9013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9010,9013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9035,9038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9035,9038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":310,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":310,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .fullName on an `any` value.","line":310,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":310,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":311,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":311,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .description on an `any` value.","line":311,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":311,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":312,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":312,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .readme on an `any` value.","line":312,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":312,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":312,"column":33,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":312,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .readme on an `any` value.","line":312,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":312,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":313,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":313,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .htmlUrl on an `any` value.","line":313,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":313,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":314,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":314,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .cloneUrl on an `any` value.","line":314,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":314,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":319,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":319,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .owner on an `any` value.","line":319,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":319,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":320,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":320,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .owner on an `any` value.","line":320,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":320,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":321,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":321,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .owner on an `any` value.","line":321,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":321,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .owner on an `any` value.","line":324,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":324,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .owner on an `any` value.","line":324,"column":71,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":324,"endColumn":76},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string | number | Date`.","line":327,"column":29,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":327,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .createdAt on an `any` value.","line":327,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":327,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":330,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":330,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .language on an `any` value.","line":330,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":330,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .languages on an `any` value.","line":331,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":331,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `{}`.","line":331,"column":51,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":331,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .languages on an `any` value.","line":331,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":331,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe spread of an `any` value in an array.","line":332,"column":14,"nodeType":"SpreadElement","messageId":"unsafeArraySpread","endLine":332,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .topics on an `any` value.","line":332,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":332,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .language on an `any` value.","line":332,"column":49,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":332,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":335,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":335,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .watchersCount on an `any` value.","line":335,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":335,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":336,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":336,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .stargazersCount on an `any` value.","line":336,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":336,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":337,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":337,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .stargazersCount on an `any` value.","line":337,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":337,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":345,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":345,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":345,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":345,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":346,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":346,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .fullName on an `any` value.","line":346,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":346,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":347,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":347,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .license on an `any` value.","line":347,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":347,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":348,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":348,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .forksCount on an `any` value.","line":348,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":348,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":349,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":349,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .openIssuesCount on an `any` value.","line":349,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":349,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":350,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":350,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .homepage on an `any` value.","line":350,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":350,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":351,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":351,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .topics on an `any` value.","line":351,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":351,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":352,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":355,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":352,"column":23,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":352,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .contributors on an `any` value.","line":352,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":352,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":352,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":352,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10593,10596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10593,10596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":353,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":353,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .login on an `any` value.","line":353,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":353,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":354,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":354,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .contributions on an `any` value.","line":354,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":354,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":356,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":356,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .updatedAt on an `any` value.","line":356,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":356,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":357,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":357,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .pushedAt on an `any` value.","line":357,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":357,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":368,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":368,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10927,10930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10927,10930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":369,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":369,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .stargazersCount on an `any` value.","line":369,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":369,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":370,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":370,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .forksCount on an `any` value.","line":370,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":370,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .readme on an `any` value.","line":371,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":371,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .license on an `any` value.","line":372,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":372,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":373,"column":50,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":373,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .pushedAt on an `any` value.","line":373,"column":58,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":373,"endColumn":66},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":389,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":389,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11555,11558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11555,11558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":390,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":390,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .stargazersCount on an `any` value.","line":390,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":390,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":391,"column":49,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":391,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .createdAt on an `any` value.","line":391,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":391,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":392,"column":47,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":392,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .pushedAt on an `any` value.","line":392,"column":55,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":392,"endColumn":63},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":434,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":434,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12844,12847],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12844,12847],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":435,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":435,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12870,12873],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12870,12873],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .Authorization on an `any` value.","line":441,"column":15,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":441,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":202,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, Logger } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { PrismaService } from '../common/prisma/prisma.service';\r\nimport { MongoDBService } from '../common/mongodb/mongodb.service';\r\nimport { DeduplicationService } from './deduplication.service';\r\nimport { getErrorStack } from '../common/utils/error.utils';\r\nimport axios from 'axios';\r\n\r\n/**\r\n * GitHub 项目采集器\r\n *\r\n * 关键功能：\r\n * 1. 存储完整信息到 MongoDB raw_data 集合\r\n * 2. 建立 raw_data ↔ resource 的引用关系\r\n * 3. 实现去重逻辑（基于 GitHub repo URL）\r\n * 4. 解析所有字段（名称、描述、星标、语言、README等）\r\n */\r\n@Injectable()\r\nexport class GithubService {\r\n  private readonly logger = new Logger(GithubService.name);\r\n  private readonly GITHUB_API_URL = 'https://api.github.com';\r\n  private readonly githubToken: string;\r\n\r\n  constructor(\r\n    private prisma: PrismaService,\r\n    private mongodb: MongoDBService,\r\n    _dedup: DeduplicationService,\r\n    private config: ConfigService,\r\n  ) {\r\n    this.githubToken = this.config.get<string>('GITHUB_TOKEN') || '';\r\n    if (!this.githubToken || this.githubToken.startsWith('your_')) {\r\n      this.logger.warn('GitHub token not configured, API rate limit will be very low');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取 GitHub 趋势项目\r\n   * @param language 编程语言（可选）\r\n   * @param since 时间范围：daily, weekly, monthly\r\n   */\r\n  async fetchTrendingRepos(language?: string, since: 'daily' | 'weekly' | 'monthly' = 'daily'): Promise<number> {\r\n    this.logger.log(`Fetching GitHub trending repos (language: ${language || 'all'}, since: ${since})`);\r\n\r\n    try {\r\n      // GitHub Trending 没有官方 API，使用 GitHub Search API 作为替代\r\n      // 搜索最近创建且星标最多的项目\r\n      const dateThreshold = this.getDateThreshold(since);\r\n\r\n      let query = `created:>${dateThreshold} stars:>50`;\r\n      if (language) {\r\n        query += ` language:${language}`;\r\n      }\r\n\r\n      const params = {\r\n        q: query,\r\n        sort: 'stars',\r\n        order: 'desc',\r\n        per_page: 30,\r\n      };\r\n\r\n      const response = await axios.get(`${this.GITHUB_API_URL}/search/repositories`, {\r\n        params,\r\n        headers: this.getHeaders(),\r\n      });\r\n\r\n      const repos = response.data.items || [];\r\n      this.logger.log(`Found ${repos.length} trending repositories`);\r\n\r\n      let successCount = 0;\r\n      for (const repo of repos) {\r\n        try {\r\n          await this.processRepository(repo);\r\n          successCount++;\r\n        } catch (error) {\r\n          this.logger.error(`Failed to process repo: ${repo.full_name}`, getErrorStack(error));\r\n        }\r\n      }\r\n\r\n      this.logger.log(`Successfully processed ${successCount}/${repos.length} repos`);\r\n      return successCount;\r\n    } catch (error) {\r\n      this.logger.error('Failed to fetch GitHub trending repos', getErrorStack(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 搜索 GitHub 项目\r\n   */\r\n  async searchRepositories(query: string, maxResults = 10): Promise<number> {\r\n    this.logger.log(`Searching GitHub repos: \"${query}\"`);\r\n\r\n    try {\r\n      const params = {\r\n        q: query,\r\n        sort: 'stars',\r\n        order: 'desc',\r\n        per_page: maxResults,\r\n      };\r\n\r\n      const response = await axios.get(`${this.GITHUB_API_URL}/search/repositories`, {\r\n        params,\r\n        headers: this.getHeaders(),\r\n      });\r\n\r\n      const repos = response.data.items || [];\r\n\r\n      let successCount = 0;\r\n      for (const repo of repos) {\r\n        try {\r\n          await this.processRepository(repo);\r\n          successCount++;\r\n        } catch (error) {\r\n          this.logger.error(`Failed to process repo`, getErrorStack(error));\r\n        }\r\n      }\r\n\r\n      return successCount;\r\n    } catch (error) {\r\n      this.logger.error('Search failed', getErrorStack(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 处理单个仓库\r\n   */\r\n  private async processRepository(repo: any): Promise<void> {\r\n    const repoFullName = repo.full_name;\r\n\r\n    // 检查是否已存在（去重）\r\n    const existingRawData = await this.mongodb.findRawDataByExternalId('github', repoFullName);\r\n\r\n    if (existingRawData) {\r\n      this.logger.debug(`Repo already exists: ${repoFullName}`);\r\n      return;\r\n    }\r\n\r\n    // 获取完整的仓库信息（包括 README）\r\n    const fullRepoData = await this.fetchFullRepositoryData(repo.owner.login, repo.name);\r\n\r\n    // 解析完整的原始数据\r\n    const rawData = this.parseRawData(fullRepoData, repoFullName);\r\n\r\n    // 1. 存储完整原始数据到 MongoDB\r\n    const rawDataId = await this.mongodb.insertRawData('github', rawData);\r\n\r\n    this.logger.log(`Stored raw data in MongoDB: ${repoFullName} -> ${rawDataId}`);\r\n\r\n    // 2. 提取结构化数据并存储到 PostgreSQL\r\n    const resourceData = this.extractResourceData(rawData, rawDataId);\r\n\r\n    const resource = await this.prisma.resource.create({\r\n      data: resourceData,\r\n    });\r\n\r\n    this.logger.log(`Created resource in PostgreSQL with rawDataId: ${rawDataId}`);\r\n\r\n    // 3. ⚠️ 关键：建立反向引用（MongoDB → PostgreSQL）\r\n    await this.mongodb.linkResourceToRawData(rawDataId, resource.id);\r\n  }\r\n\r\n  /**\r\n   * 获取完整的仓库数据（包括 README、languages 等）\r\n   */\r\n  private async fetchFullRepositoryData(owner: string, repo: string): Promise<any> {\r\n    const headers = this.getHeaders();\r\n\r\n    try {\r\n      // 并行获取多个数据\r\n      const [repoData, readmeData, languagesData, contributorsData] = await Promise.allSettled([\r\n        axios.get(`${this.GITHUB_API_URL}/repos/${owner}/${repo}`, { headers }),\r\n        this.fetchReadme(owner, repo),\r\n        axios.get(`${this.GITHUB_API_URL}/repos/${owner}/${repo}/languages`, { headers }),\r\n        axios.get(`${this.GITHUB_API_URL}/repos/${owner}/${repo}/contributors`, {\r\n          headers,\r\n          params: { per_page: 5 },\r\n        }),\r\n      ]);\r\n\r\n      const data: any = {\r\n        ...(repoData.status === 'fulfilled' ? repoData.value.data : {}),\r\n        readme: readmeData.status === 'fulfilled' ? readmeData.value : null,\r\n        languages: languagesData.status === 'fulfilled' ? languagesData.value.data : {},\r\n        contributors: contributorsData.status === 'fulfilled' ? contributorsData.value.data : [],\r\n      };\r\n\r\n      return data;\r\n    } catch (error) {\r\n      this.logger.error(`Failed to fetch full repo data for ${owner}/${repo}`, getErrorStack(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取 README 内容\r\n   */\r\n  private async fetchReadme(owner: string, repo: string): Promise<string | null> {\r\n    try {\r\n      const response = await axios.get(`${this.GITHUB_API_URL}/repos/${owner}/${repo}/readme`, {\r\n        headers: {\r\n          ...this.getHeaders(),\r\n          Accept: 'application/vnd.github.v3.raw', // 获取原始内容\r\n        },\r\n      });\r\n\r\n      return response.data;\r\n    } catch (error) {\r\n      this.logger.debug(`No README found for ${owner}/${repo}`);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 解析完整的原始数据（存储到 MongoDB）\r\n   *\r\n   * ⚠️ 关键：存储所有字段，包括 README、contributors 等！\r\n   */\r\n  private parseRawData(repoData: any, repoFullName: string): any {\r\n    return {\r\n      // 外部 ID（用于去重）\r\n      externalId: repoFullName,\r\n\r\n      // 基础信息\r\n      id: repoData.id,\r\n      name: repoData.name,\r\n      fullName: repoData.full_name,\r\n      owner: {\r\n        login: repoData.owner?.login,\r\n        id: repoData.owner?.id,\r\n        avatarUrl: repoData.owner?.avatar_url,\r\n        url: repoData.owner?.url,\r\n        type: repoData.owner?.type,\r\n      },\r\n\r\n      // 描述和文档\r\n      description: repoData.description,\r\n      readme: repoData.readme, // ⚠️ 完整 README\r\n\r\n      // URL 信息\r\n      htmlUrl: repoData.html_url,\r\n      homepage: repoData.homepage,\r\n      cloneUrl: repoData.clone_url,\r\n      gitUrl: repoData.git_url,\r\n\r\n      // 统计数据\r\n      stargazersCount: repoData.stargazers_count,\r\n      watchersCount: repoData.watchers_count,\r\n      forksCount: repoData.forks_count,\r\n      openIssuesCount: repoData.open_issues_count,\r\n\r\n      // 语言信息（完整）\r\n      language: repoData.language,\r\n      languages: repoData.languages, // ⚠️ 所有语言的字节数统计\r\n\r\n      // 主题标签\r\n      topics: repoData.topics || [],\r\n\r\n      // 许可证\r\n      license: repoData.license\r\n        ? {\r\n            key: repoData.license.key,\r\n            name: repoData.license.name,\r\n            spdxId: repoData.license.spdx_id,\r\n          }\r\n        : null,\r\n\r\n      // 时间信息\r\n      createdAt: repoData.created_at,\r\n      updatedAt: repoData.updated_at,\r\n      pushedAt: repoData.pushed_at,\r\n\r\n      // 贡献者信息（前5名）\r\n      contributors: repoData.contributors || [],\r\n\r\n      // 其他元数据\r\n      size: repoData.size,\r\n      defaultBranch: repoData.default_branch,\r\n      isPrivate: repoData.private,\r\n      isFork: repoData.fork,\r\n      isArchived: repoData.archived,\r\n      isTemplate: repoData.is_template,\r\n      hasIssues: repoData.has_issues,\r\n      hasProjects: repoData.has_projects,\r\n      hasWiki: repoData.has_wiki,\r\n      hasPages: repoData.has_pages,\r\n      hasDownloads: repoData.has_downloads,\r\n\r\n      // 原始数据（完整保存）\r\n      _raw: repoData,\r\n\r\n      // 采集时间\r\n      fetchedAt: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 从原始数据提取结构化数据（存储到 PostgreSQL）\r\n   *\r\n   * ⚠️ 关键：建立 rawDataId 引用关系！\r\n   */\r\n  private extractResourceData(rawData: any, rawDataId: string): any {\r\n    // 计算质量评分（基于 stars, forks, 活跃度）\r\n    const qualityScore = this.calculateQualityScore(rawData);\r\n\r\n    return {\r\n      type: 'PROJECT',\r\n\r\n      // 基础信息\r\n      title: rawData.fullName,\r\n      abstract: rawData.description || '',\r\n      content: rawData.readme ? rawData.readme.substring(0, 10000) : null, // 截取前10000字符\r\n      sourceUrl: rawData.htmlUrl,\r\n      codeUrl: rawData.cloneUrl,\r\n\r\n      // 作者/组织\r\n      authors: [\r\n        {\r\n          name: rawData.owner.login,\r\n          url: rawData.owner.url,\r\n          type: rawData.owner.type,\r\n        },\r\n      ],\r\n      organizations: rawData.owner.type === 'Organization' ? [rawData.owner.login] : null,\r\n\r\n      // 发布时间\r\n      publishedAt: new Date(rawData.createdAt),\r\n\r\n      // 分类和标签\r\n      primaryCategory: rawData.language || 'Unknown',\r\n      categories: rawData.languages ? Object.keys(rawData.languages) : [],\r\n      tags: [...(rawData.topics || []), rawData.language].filter(Boolean),\r\n\r\n      // 统计数据\r\n      viewCount: rawData.watchersCount,\r\n      saveCount: rawData.stargazersCount,\r\n      upvoteCount: rawData.stargazersCount,\r\n\r\n      // 评分\r\n      qualityScore: qualityScore,\r\n      trendingScore: this.calculateTrendingScore(rawData),\r\n\r\n      // 元数据\r\n      metadata: {\r\n        githubId: rawData.id,\r\n        fullName: rawData.fullName,\r\n        license: rawData.license,\r\n        forks: rawData.forksCount,\r\n        openIssues: rawData.openIssuesCount,\r\n        homepage: rawData.homepage,\r\n        topics: rawData.topics,\r\n        contributors: rawData.contributors.map((c: any) => ({\r\n          login: c.login,\r\n          contributions: c.contributions,\r\n        })),\r\n        updatedAt: rawData.updatedAt,\r\n        pushedAt: rawData.pushedAt,\r\n      },\r\n\r\n      // ⚠️ 关键！MongoDB 原始数据引用\r\n      rawDataId: rawDataId,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 计算质量评分（0-100）\r\n   */\r\n  private calculateQualityScore(rawData: any): number {\r\n    const stars = rawData.stargazersCount || 0;\r\n    const forks = rawData.forksCount || 0;\r\n    const hasReadme = !!rawData.readme;\r\n    const hasLicense = !!rawData.license;\r\n    const recentActivity = this.isRecentlyActive(rawData.pushedAt);\r\n\r\n    // 加权计算\r\n    let score = 0;\r\n    score += Math.min(stars / 100, 50); // 最多50分\r\n    score += Math.min(forks / 50, 20); // 最多20分\r\n    score += hasReadme ? 10 : 0;\r\n    score += hasLicense ? 10 : 0;\r\n    score += recentActivity ? 10 : 0;\r\n\r\n    return Math.min(Math.round(score), 100);\r\n  }\r\n\r\n  /**\r\n   * 计算趋势评分\r\n   */\r\n  private calculateTrendingScore(rawData: any): number {\r\n    const stars = rawData.stargazersCount || 0;\r\n    const daysSinceCreation = this.getDaysSince(rawData.createdAt);\r\n    const daysSinceUpdate = this.getDaysSince(rawData.pushedAt);\r\n\r\n    // 增长速度（stars per day）\r\n    const starsPerDay = daysSinceCreation > 0 ? stars / daysSinceCreation : 0;\r\n\r\n    // 活跃度惩罚（超过30天未更新降低评分）\r\n    const activityPenalty = daysSinceUpdate > 30 ? 0.5 : 1.0;\r\n\r\n    return starsPerDay * activityPenalty * 100;\r\n  }\r\n\r\n  /**\r\n   * 检查是否最近活跃（30天内）\r\n   */\r\n  private isRecentlyActive(pushedAt: string): boolean {\r\n    if (!pushedAt) return false;\r\n    const daysSince = this.getDaysSince(pushedAt);\r\n    return daysSince <= 30;\r\n  }\r\n\r\n  /**\r\n   * 获取距今天数\r\n   */\r\n  private getDaysSince(dateString: string): number {\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    return Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24));\r\n  }\r\n\r\n  /**\r\n   * 获取日期阈值\r\n   */\r\n  private getDateThreshold(since: string): string {\r\n    const now = new Date();\r\n    const daysAgo = since === 'daily' ? 1 : since === 'weekly' ? 7 : 30;\r\n    const date = new Date(now.getTime() - daysAgo * 24 * 60 * 60 * 1000);\r\n    return date.toISOString().split('T')[0]; // YYYY-MM-DD\r\n  }\r\n\r\n  /**\r\n   * 获取请求头\r\n   */\r\n  private getHeaders(): any {\r\n    const headers: any = {\r\n      Accept: 'application/vnd.github.v3+json',\r\n      'User-Agent': 'DeepDive-Engine',\r\n    };\r\n\r\n    if (this.githubToken && !this.githubToken.startsWith('your_')) {\r\n      headers.Authorization = `token ${this.githubToken}`;\r\n    }\r\n\r\n    return headers;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\crawler\\hackernews.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":40,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":40,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":73,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":73,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":102,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":102,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":130,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":130,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":138,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":138,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .type on an `any` value.","line":140,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":140,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":146,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":146,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":154,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":154,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":157,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":157,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .message on an `any` value.","line":167,"column":84,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":167,"endColumn":91},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5302,5305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5302,5305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":177,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":177,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5667,5670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5667,5670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5693,5696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5693,5696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":195,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":195,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":195,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":195,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":196,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":196,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .type on an `any` value.","line":196,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":196,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":197,"column":35,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":197,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .title on an `any` value.","line":197,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":197,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .text on an `any` value.","line":198,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":198,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":198,"column":51,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":198,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .text on an `any` value.","line":198,"column":61,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":198,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":199,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":199,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .url on an `any` value.","line":199,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":199,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":202,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":202,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .by on an `any` value.","line":202,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":202,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":205,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":205,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .time on an `any` value.","line":205,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":205,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .time on an `any` value.","line":206,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":206,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":209,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":209,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .score on an `any` value.","line":209,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":209,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":210,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":210,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .descendants on an `any` value.","line":210,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":210,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":213,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":213,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .kids on an `any` value.","line":213,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":213,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":216,"column":64,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":216,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":219,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":219,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .deleted on an `any` value.","line":219,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":219,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":220,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":220,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .dead on an `any` value.","line":220,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":220,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":223,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":223,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6788,6791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6788,6791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6813,6816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6813,6816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":237,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":237,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .url on an `any` value.","line":237,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":237,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .hnUrl on an `any` value.","line":237,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":237,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .url on an `any` value.","line":240,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":240,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":240,"column":59,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":240,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .url on an `any` value.","line":240,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":240,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":246,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":246,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .title on an `any` value.","line":246,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":246,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":247,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":247,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .text on an `any` value.","line":247,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":247,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":248,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":248,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .text on an `any` value.","line":248,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":248,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":249,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":249,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":254,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":254,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .by on an `any` value.","line":254,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":254,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string | number | Date`.","line":260,"column":29,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":260,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .timeFormatted on an `any` value.","line":260,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":260,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":265,"column":30,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":265,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .title on an `any` value.","line":265,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":265,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":268,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":268,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .score on an `any` value.","line":268,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":268,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":269,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":269,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .descendants on an `any` value.","line":269,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":269,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":277,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":277,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":277,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":277,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":278,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":278,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .hnUrl on an `any` value.","line":278,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":278,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":280,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":280,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .by on an `any` value.","line":280,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":280,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":281,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":281,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .descendants on an `any` value.","line":281,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":281,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":282,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":282,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":282,"column":17,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":282,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .kids on an `any` value.","line":282,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":282,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":283,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":283,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .time on an `any` value.","line":283,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":283,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":344,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9155,9158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9155,9158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":345,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":345,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .score on an `any` value.","line":345,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":345,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":346,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":346,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .descendants on an `any` value.","line":346,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":346,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":359,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9525,9528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9525,9528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":360,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":360,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .score on an `any` value.","line":360,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":360,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .time on an `any` value.","line":361,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":361,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":393,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":393,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":393,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":393,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10446,10449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10446,10449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":394,"column":55,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":394,"endColumn":57,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[10506,10508],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":92,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, Logger } from '@nestjs/common';\r\nimport { PrismaService } from '../common/prisma/prisma.service';\r\nimport { MongoDBService } from '../common/mongodb/mongodb.service';\r\nimport { DeduplicationService } from './deduplication.service';\r\nimport { AIEnrichmentService } from '../resources/ai-enrichment.service';\r\nimport { getErrorStack, getErrorMessage } from '../common/utils/error.utils';\r\nimport axios from 'axios';\r\n\r\n/**\r\n * HackerNews 采集器\r\n *\r\n * 关键功能：\r\n * 1. 存储完整信息到 MongoDB raw_data 集合\r\n * 2. 建立 raw_data ↔ resource 的引用关系\r\n * 3. 实现去重逻辑（基于 HN item ID）\r\n * 4. 解析所有字段（标题、作者、评论、URL等）\r\n */\r\n@Injectable()\r\nexport class HackernewsService {\r\n  private readonly logger = new Logger(HackernewsService.name);\r\n  private readonly HN_API_URL = 'https://hacker-news.firebaseio.com/v0';\r\n\r\n  constructor(\r\n    private prisma: PrismaService,\r\n    private mongodb: MongoDBService,\r\n    private dedup: DeduplicationService,\r\n    private aiEnrichment: AIEnrichmentService,\r\n  ) {}\r\n\r\n  /**\r\n   * 采集首页热门新闻\r\n   * @param maxResults 最大结果数\r\n   */\r\n  async fetchTopStories(maxResults = 30): Promise<number> {\r\n    this.logger.log(`Fetching HackerNews top stories (max: ${maxResults})`);\r\n\r\n    try {\r\n      // 获取热门故事 ID 列表\r\n      const response = await axios.get(`${this.HN_API_URL}/topstories.json`);\r\n      const storyIds: number[] = response.data || [];\r\n\r\n      // 限制数量\r\n      const selectedIds = storyIds.slice(0, maxResults);\r\n      this.logger.log(`Found ${selectedIds.length} top stories`);\r\n\r\n      // 处理每个故事\r\n      let successCount = 0;\r\n      for (const id of selectedIds) {\r\n        try {\r\n          await this.processStory(id);\r\n          successCount++;\r\n        } catch (error) {\r\n          this.logger.error(`Failed to process story ${id}`, getErrorStack(error));\r\n        }\r\n      }\r\n\r\n      this.logger.log(`Successfully processed ${successCount}/${selectedIds.length} stories`);\r\n      return successCount;\r\n    } catch (error) {\r\n      this.logger.error('Failed to fetch HackerNews stories', getErrorStack(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 采集最新故事\r\n   */\r\n  async fetchNewStories(maxResults = 30): Promise<number> {\r\n    this.logger.log(`Fetching HackerNews new stories (max: ${maxResults})`);\r\n\r\n    try {\r\n      const response = await axios.get(`${this.HN_API_URL}/newstories.json`);\r\n      const storyIds: number[] = response.data || [];\r\n\r\n      const selectedIds = storyIds.slice(0, maxResults);\r\n\r\n      let successCount = 0;\r\n      for (const id of selectedIds) {\r\n        try {\r\n          await this.processStory(id);\r\n          successCount++;\r\n        } catch (error) {\r\n          this.logger.error(`Failed to process story ${id}`, getErrorStack(error));\r\n        }\r\n      }\r\n\r\n      return successCount;\r\n    } catch (error) {\r\n      this.logger.error('Failed to fetch new stories', getErrorStack(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 采集最佳故事\r\n   */\r\n  async fetchBestStories(maxResults = 30): Promise<number> {\r\n    this.logger.log(`Fetching HackerNews best stories (max: ${maxResults})`);\r\n\r\n    try {\r\n      const response = await axios.get(`${this.HN_API_URL}/beststories.json`);\r\n      const storyIds: number[] = response.data || [];\r\n\r\n      const selectedIds = storyIds.slice(0, maxResults);\r\n\r\n      let successCount = 0;\r\n      for (const id of selectedIds) {\r\n        try {\r\n          await this.processStory(id);\r\n          successCount++;\r\n        } catch (error) {\r\n          this.logger.error(`Failed to process story ${id}`, getErrorStack(error));\r\n        }\r\n      }\r\n\r\n      return successCount;\r\n    } catch (error) {\r\n      this.logger.error('Failed to fetch best stories', getErrorStack(error));\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 处理单个故事\r\n   */\r\n  private async processStory(itemId: number): Promise<void> {\r\n    const externalId = itemId.toString();\r\n\r\n    // 检查是否已存在（去重）\r\n    const existingRawData = await this.mongodb.findRawDataByExternalId('hackernews', externalId);\r\n\r\n    if (existingRawData) {\r\n      this.logger.debug(`Story already exists: ${itemId}`);\r\n      return;\r\n    }\r\n\r\n    // 获取故事详情\r\n    const storyData = await this.fetchItem(itemId);\r\n\r\n    if (!storyData || storyData.type !== 'story') {\r\n      this.logger.debug(`Item ${itemId} is not a story`);\r\n      return;\r\n    }\r\n\r\n    // 解析完整的原始数据\r\n    const rawData = this.parseRawData(storyData, externalId);\r\n\r\n    // 1. 存储完整原始数据到 MongoDB\r\n    const rawDataId = await this.mongodb.insertRawData('hackernews', rawData);\r\n\r\n    this.logger.log(`Stored raw data in MongoDB: HN-${itemId} -> ${rawDataId}`);\r\n\r\n    // 2. 提取结构化数据并存储到 PostgreSQL\r\n    const resourceData = this.extractResourceData(rawData, rawDataId);\r\n\r\n    const resource = await this.prisma.resource.create({\r\n      data: resourceData,\r\n    });\r\n\r\n    this.logger.log(`Created resource in PostgreSQL with rawDataId: ${rawDataId}`);\r\n\r\n    // 3. ⚠️ 关键：建立反向引用（MongoDB → PostgreSQL）\r\n    await this.mongodb.linkResourceToRawData(rawDataId, resource.id);\r\n\r\n    // 4. AI 增强处理（异步，不阻塞主流程）\r\n    this.enrichResourceWithAI(resource.id, resource.title, resource.sourceUrl).catch((error) => {\r\n      this.logger.error(`Failed to enrich resource ${resource.id} with AI:`, error.message);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 获取单个 item 详情\r\n   */\r\n  private async fetchItem(id: number): Promise<any> {\r\n    try {\r\n      const response = await axios.get(`${this.HN_API_URL}/item/${id}.json`);\r\n      return response.data;\r\n    } catch (error) {\r\n      this.logger.error(`Failed to fetch item ${id}`, getErrorStack(error));\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 解析完整的原始数据（存储到 MongoDB）\r\n   *\r\n   * ⚠️ 关键：存储所有字段！\r\n   */\r\n  private parseRawData(storyData: any, externalId: string): any {\r\n    return {\r\n      // 外部 ID（用于去重）\r\n      externalId: externalId,\r\n\r\n      // 基础信息\r\n      id: storyData.id,\r\n      type: storyData.type,\r\n      title: this.dedup.cleanText(storyData.title),\r\n      text: storyData.text ? this.dedup.cleanText(storyData.text) : null,\r\n      url: storyData.url || null,\r\n\r\n      // 作者信息\r\n      by: storyData.by,\r\n\r\n      // 时间信息（Unix timestamp）\r\n      time: storyData.time,\r\n      timeFormatted: new Date(storyData.time * 1000).toISOString(),\r\n\r\n      // 统计数据\r\n      score: storyData.score || 0,\r\n      descendants: storyData.descendants || 0, // 评论总数\r\n\r\n      // 评论 ID 列表（完整）\r\n      kids: storyData.kids || [],\r\n\r\n      // HackerNews URL\r\n      hnUrl: `https://news.ycombinator.com/item?id=${storyData.id}`,\r\n\r\n      // 是否已删除\r\n      deleted: storyData.deleted || false,\r\n      dead: storyData.dead || false,\r\n\r\n      // 原始数据（完整保存）\r\n      _raw: storyData,\r\n\r\n      // 采集时间\r\n      fetchedAt: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 从原始数据提取结构化数据（存储到 PostgreSQL）\r\n   *\r\n   * ⚠️ 关键：建立 rawDataId 引用关系！\r\n   */\r\n  private extractResourceData(rawData: any, rawDataId: string): any {\r\n    // 确定资源 URL\r\n    const sourceUrl = rawData.url || rawData.hnUrl;\r\n\r\n    // 提取域名作为分类\r\n    const domain = rawData.url ? this.dedup.extractDomain(rawData.url) : 'news.ycombinator.com';\r\n\r\n    return {\r\n      type: 'NEWS',\r\n\r\n      // 基础信息\r\n      title: rawData.title,\r\n      abstract: rawData.text || '',\r\n      content: rawData.text || '',\r\n      sourceUrl: sourceUrl,\r\n\r\n      // 作者\r\n      authors: [\r\n        {\r\n          username: rawData.by,\r\n          platform: 'hackernews',\r\n        },\r\n      ],\r\n\r\n      // 发布时间\r\n      publishedAt: new Date(rawData.timeFormatted),\r\n\r\n      // 分类\r\n      primaryCategory: 'Tech News',\r\n      categories: domain ? [domain] : ['Tech News'],\r\n      tags: this.extractTags(rawData.title),\r\n\r\n      // 统计数据\r\n      upvoteCount: rawData.score,\r\n      commentCount: rawData.descendants,\r\n\r\n      // 评分\r\n      qualityScore: this.calculateQualityScore(rawData),\r\n      trendingScore: this.calculateTrendingScore(rawData),\r\n\r\n      // 元数据\r\n      metadata: {\r\n        hnId: rawData.id,\r\n        hnUrl: rawData.hnUrl,\r\n        domain: domain,\r\n        author: rawData.by,\r\n        commentsCount: rawData.descendants,\r\n        kidIds: rawData.kids.slice(0, 10), // 保存前10个评论ID\r\n        timestamp: rawData.time,\r\n      },\r\n\r\n      // ⚠️ 关键！MongoDB 原始数据引用\r\n      rawDataId: rawDataId,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 从标题提取标签\r\n   */\r\n  private extractTags(title: string): string[] {\r\n    const tags: string[] = [];\r\n\r\n    // 常见技术关键词\r\n    const keywords = [\r\n      'AI',\r\n      'ML',\r\n      'Python',\r\n      'JavaScript',\r\n      'TypeScript',\r\n      'React',\r\n      'Vue',\r\n      'Node',\r\n      'Docker',\r\n      'Kubernetes',\r\n      'AWS',\r\n      'Google',\r\n      'Microsoft',\r\n      'Apple',\r\n      'Security',\r\n      'Privacy',\r\n      'Crypto',\r\n      'Blockchain',\r\n      'Web3',\r\n      'API',\r\n      'Database',\r\n      'Cloud',\r\n    ];\r\n\r\n    const titleLower = title.toLowerCase();\r\n    for (const keyword of keywords) {\r\n      if (titleLower.includes(keyword.toLowerCase())) {\r\n        tags.push(keyword);\r\n      }\r\n    }\r\n\r\n    // 检查是否是 Show HN 或 Ask HN\r\n    if (title.startsWith('Show HN:')) {\r\n      tags.push('Show HN');\r\n    }\r\n    if (title.startsWith('Ask HN:')) {\r\n      tags.push('Ask HN');\r\n    }\r\n\r\n    return tags;\r\n  }\r\n\r\n  /**\r\n   * 计算质量评分（0-100）\r\n   */\r\n  private calculateQualityScore(rawData: any): number {\r\n    const score = rawData.score || 0;\r\n    const comments = rawData.descendants || 0;\r\n\r\n    // 加权计算\r\n    let quality = 0;\r\n    quality += Math.min(score / 10, 70); // 最多70分\r\n    quality += Math.min(comments / 5, 30); // 最多30分\r\n\r\n    return Math.min(Math.round(quality), 100);\r\n  }\r\n\r\n  /**\r\n   * 计算趋势评分\r\n   */\r\n  private calculateTrendingScore(rawData: any): number {\r\n    const score = rawData.score || 0;\r\n    const ageInHours = (Date.now() - rawData.time * 1000) / (1000 * 60 * 60);\r\n\r\n    // HackerNews 算法：分数 / (年龄 + 2)^1.8\r\n    const gravity = 1.8;\r\n    const trendingScore = score / Math.pow(ageInHours + 2, gravity);\r\n\r\n    return trendingScore * 100;\r\n  }\r\n\r\n  /**\r\n   * AI 增强资源\r\n   * 异步调用，不阻塞主流程\r\n   */\r\n  private async enrichResourceWithAI(\r\n    resourceId: string,\r\n    title: string,\r\n    sourceUrl: string,\r\n  ): Promise<void> {\r\n    try {\r\n      this.logger.log(`Starting AI enrichment for resource ${resourceId}`);\r\n\r\n      // 调用 AI 增强服务\r\n      const enrichment = await this.aiEnrichment.enrichResource({\r\n        title,\r\n        sourceUrl,\r\n      });\r\n\r\n      // 更新资源\r\n      await this.prisma.resource.update({\r\n        where: { id: resourceId },\r\n        data: {\r\n          aiSummary: enrichment.aiSummary,\r\n          keyInsights: enrichment.keyInsights as any,\r\n          primaryCategory: enrichment.primaryCategory || 'Tech News',\r\n          autoTags: enrichment.autoTags,\r\n          difficultyLevel: enrichment.difficultyLevel,\r\n        },\r\n      });\r\n\r\n      this.logger.log(\r\n        `AI enrichment completed for resource ${resourceId}: ` +\r\n        `summary=${!!enrichment.aiSummary}, insights=${enrichment.keyInsights.length}, tags=${enrichment.autoTags.length}`,\r\n      );\r\n    } catch (error) {\r\n      // 失败不影响主流程，只记录日志\r\n      this.logger.warn(`AI enrichment failed for resource ${resourceId}: ${getErrorMessage(error)}`);\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\feed\\feed.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\feed\\feed.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\feed\\feed.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":37,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":37,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[840,843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[840,843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":117,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":117,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2616,2619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2616,2619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, Logger } from '@nestjs/common';\r\nimport { PrismaService } from '../common/prisma/prisma.service';\r\nimport { Prisma } from '@prisma/client';\r\n\r\n/**\r\n * Feed 流服务\r\n */\r\n@Injectable()\r\nexport class FeedService {\r\n  private readonly logger = new Logger(FeedService.name);\r\n\r\n  constructor(private prisma: PrismaService) {}\r\n\r\n  /**\r\n   * 获取 Feed 流（时间倒序）\r\n   */\r\n  async getFeed(params: {\r\n    skip?: number;\r\n    take?: number;\r\n    type?: string;\r\n    category?: string;\r\n    minQualityScore?: number;\r\n    sortBy?: 'publishedAt' | 'qualityScore' | 'trendingScore';\r\n  }) {\r\n    const {\r\n      skip = 0,\r\n      take = 20,\r\n      type,\r\n      category,\r\n      minQualityScore,\r\n      sortBy = 'publishedAt',\r\n    } = params;\r\n\r\n    const where: Prisma.ResourceWhereInput = {};\r\n\r\n    if (type) {\r\n      where.type = type as any;\r\n    }\r\n\r\n    if (category) {\r\n      where.categories = {\r\n        array_contains: category,\r\n      };\r\n    }\r\n\r\n    if (minQualityScore) {\r\n      where.qualityScore = {\r\n        gte: minQualityScore.toString(),\r\n      };\r\n    }\r\n\r\n    const [resources, total] = await Promise.all([\r\n      this.prisma.resource.findMany({\r\n        where,\r\n        skip,\r\n        take,\r\n        orderBy: {\r\n          [sortBy]: 'desc',\r\n        },\r\n        select: {\r\n          id: true,\r\n          type: true,\r\n          title: true,\r\n          abstract: true,\r\n          sourceUrl: true,\r\n          pdfUrl: true,\r\n          codeUrl: true,\r\n          authors: true,\r\n          publishedAt: true,\r\n          aiSummary: true,\r\n          primaryCategory: true,\r\n          categories: true,\r\n          tags: true,\r\n          qualityScore: true,\r\n          trendingScore: true,\r\n          viewCount: true,\r\n          upvoteCount: true,\r\n          commentCount: true,\r\n          createdAt: true,\r\n        },\r\n      }),\r\n      this.prisma.resource.count({ where }),\r\n    ]);\r\n\r\n    return {\r\n      data: resources,\r\n      pagination: {\r\n        total,\r\n        skip,\r\n        take,\r\n        hasMore: skip + take < total,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 搜索资源\r\n   */\r\n  async search(params: {\r\n    query: string;\r\n    skip?: number;\r\n    take?: number;\r\n    type?: string;\r\n    category?: string;\r\n  }) {\r\n    const { query, skip = 0, take = 20, type, category } = params;\r\n\r\n    const where: Prisma.ResourceWhereInput = {\r\n      OR: [\r\n        { title: { contains: query, mode: 'insensitive' } },\r\n        { abstract: { contains: query, mode: 'insensitive' } },\r\n        { content: { contains: query, mode: 'insensitive' } },\r\n      ],\r\n    };\r\n\r\n    if (type) {\r\n      where.type = type as any;\r\n    }\r\n\r\n    if (category) {\r\n      where.categories = {\r\n        array_contains: category,\r\n      };\r\n    }\r\n\r\n    const [resources, total] = await Promise.all([\r\n      this.prisma.resource.findMany({\r\n        where,\r\n        skip,\r\n        take,\r\n        orderBy: {\r\n          publishedAt: 'desc',\r\n        },\r\n      }),\r\n      this.prisma.resource.count({ where }),\r\n    ]);\r\n\r\n    this.logger.log(`Search query \"${query}\" returned ${resources.length} results`);\r\n\r\n    return {\r\n      query,\r\n      data: resources,\r\n      pagination: {\r\n        total,\r\n        skip,\r\n        take,\r\n        hasMore: skip + take < total,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 获取热门资源\r\n   */\r\n  async getTrending(take = 10) {\r\n    const resources = await this.prisma.resource.findMany({\r\n      take,\r\n      orderBy: {\r\n        trendingScore: 'desc',\r\n      },\r\n      where: {\r\n        trendingScore: {\r\n          not: '0',\r\n        },\r\n      },\r\n    });\r\n\r\n    return resources;\r\n  }\r\n\r\n  /**\r\n   * 获取相关资源\r\n   */\r\n  async getRelated(resourceId: string, take = 5) {\r\n    // 获取目标资源\r\n    const resource = await this.prisma.resource.findUnique({\r\n      where: { id: resourceId },\r\n      select: { categories: true, tags: true, type: true },\r\n    });\r\n\r\n    if (!resource) {\r\n      return [];\r\n    }\r\n\r\n    // 查找相关资源（相同类型和类别）\r\n    const related = await this.prisma.resource.findMany({\r\n      where: {\r\n        id: { not: resourceId },\r\n        type: resource.type,\r\n        OR: [\r\n          ...(Array.isArray(resource.categories)\r\n            ? (resource.categories as string[]).map((cat) => ({\r\n                categories: { array_contains: cat },\r\n              }))\r\n            : []),\r\n          ...(Array.isArray(resource.tags)\r\n            ? (resource.tags as string[]).map((tag) => ({\r\n                tags: { array_contains: tag },\r\n              }))\r\n            : []),\r\n        ],\r\n      },\r\n      take,\r\n      orderBy: {\r\n        qualityScore: 'desc',\r\n      },\r\n    });\r\n\r\n    return related;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\knowledge-graph\\knowledge-graph.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\knowledge-graph\\knowledge-graph.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\knowledge-graph\\knowledge-graph.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[987,990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[987,990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `{ username: string; platform?: string | undefined; }`.","line":36,"column":37,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":36,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":37,"column":53,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":37,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .username on an `any` value.","line":37,"column":60,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":37,"endColumn":68},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2003,2006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2003,2006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":69,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":69,"endColumn":84},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":69,"column":66,"nodeType":"Property","messageId":"anyAssignment","endLine":69,"endColumn":81},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":69,"column":79,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":69,"endColumn":81},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":75,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":75,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":75,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":75,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":76,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":76,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .type on an `any` value.","line":76,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":76,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":77,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":77,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .title on an `any` value.","line":77,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":77,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":78,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":78,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":78,"column":17,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":78,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .abstract on an `any` value.","line":78,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":78,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":79,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":79,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":79,"column":20,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":79,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .publishedAt on an `any` value.","line":79,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":79,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":80,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":80,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .qualityScore on an `any` value.","line":80,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":80,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":81,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":81,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":81,"column":18,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":81,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .createdAt on an `any` value.","line":81,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":81,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":89,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":89,"endColumn":92},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":96,"column":33,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":96,"endColumn":35,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2895,2897],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":104,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":104,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":116,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":116,"endColumn":73},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5043,5046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5043,5046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":182,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":189,"endColumn":6},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":191,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":191,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `any[]`.","line":191,"column":33,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":191,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5384,5387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5384,5387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":198,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":205,"endColumn":6},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":207,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":207,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `any[]`.","line":207,"column":33,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":207,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5750,5753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5750,5753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":214,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":221,"endColumn":6},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":223,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":223,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `any[]`.","line":223,"column":33,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":223,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6090,6093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6090,6093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":230,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":233,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":235,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":238,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":241,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":241,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":242,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":242,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6561,6564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6561,6564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":250,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":260,"endColumn":6},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":262,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":265,"endColumn":9},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":262,"column":12,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":262,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .map on an `any` value.","line":262,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":262,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":271,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7207,7210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7207,7210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":271,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7215,7218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7215,7218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .path on an `any` value.","line":276,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":276,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":277,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":277,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .path on an `any` value.","line":277,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":277,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .segments on an `any` value.","line":280,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":280,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .segments on an `any` value.","line":281,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":281,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":282,"column":19,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":282,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .start on an `any` value.","line":282,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":282,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":283,"column":19,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":283,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .end on an `any` value.","line":283,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":283,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":285,"column":28,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":285,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .identity on an `any` value.","line":285,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":285,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":286,"column":25,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":286,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .identity on an `any` value.","line":286,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":286,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":287,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":287,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":287,"column":21,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":287,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .identity on an `any` value.","line":287,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":287,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":288,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":288,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .labels on an `any` value.","line":288,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":288,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":289,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":289,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .properties on an `any` value.","line":289,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":289,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":293,"column":28,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":293,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .identity on an `any` value.","line":293,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":293,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":294,"column":25,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":294,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .identity on an `any` value.","line":294,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":294,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":295,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":295,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":295,"column":21,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":295,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .identity on an `any` value.","line":295,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":295,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":296,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":296,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .labels on an `any` value.","line":296,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":296,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":297,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":297,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .properties on an `any` value.","line":297,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":297,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":303,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":303,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":303,"column":23,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":303,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .identity on an `any` value.","line":303,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":303,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":304,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":304,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":304,"column":23,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":304,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .identity on an `any` value.","line":304,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":304,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":305,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":305,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .relationship on an `any` value.","line":305,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":305,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":306,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":306,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .relationship on an `any` value.","line":306,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":306,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":94,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, Logger } from '@nestjs/common';\r\nimport { Neo4jService } from '../common/neo4j/neo4j.service';\r\nimport { PrismaService } from '../common/prisma/prisma.service';\r\nimport { getErrorMessage } from '../common/utils/error.utils';\r\n\r\n/**\r\n * 知识图谱服务\r\n */\r\n@Injectable()\r\nexport class KnowledgeGraphService {\r\n  private readonly logger = new Logger(KnowledgeGraphService.name);\r\n\r\n  constructor(\r\n    private neo4j: Neo4jService,\r\n    private prisma: PrismaService,\r\n  ) {}\r\n\r\n  /**\r\n   * 从资源构建知识图谱节点\r\n   */\r\n  async buildGraphFromResource(resourceId: string): Promise<void> {\r\n    const resource = await this.prisma.resource.findUnique({\r\n      where: { id: resourceId },\r\n    });\r\n\r\n    if (!resource) {\r\n      throw new Error(`Resource ${resourceId} not found`);\r\n    }\r\n\r\n    // 1. 创建资源节点\r\n    await this.createResourceNode(resource);\r\n\r\n    // 2. 创建作者节点和关系\r\n    if (resource.authors && Array.isArray(resource.authors)) {\r\n      for (const author of resource.authors as any[]) {\r\n        await this.createAuthorNode(author);\r\n        await this.linkResourceToAuthor(resourceId, author.username);\r\n      }\r\n    }\r\n\r\n    // 3. 创建主题/分类节点和关系\r\n    if (resource.primaryCategory) {\r\n      await this.createTopicNode(resource.primaryCategory);\r\n      await this.linkResourceToTopic(resourceId, resource.primaryCategory);\r\n    }\r\n\r\n    if (resource.categories && Array.isArray(resource.categories)) {\r\n      for (const category of resource.categories as string[]) {\r\n        await this.createTopicNode(category);\r\n        await this.linkResourceToTopic(resourceId, category);\r\n      }\r\n    }\r\n\r\n    // 4. 创建标签节点和关系\r\n    if (resource.tags && Array.isArray(resource.tags)) {\r\n      for (const tag of resource.tags as string[]) {\r\n        await this.createTagNode(tag);\r\n        await this.linkResourceToTag(resourceId, tag);\r\n      }\r\n    }\r\n\r\n    this.logger.log(`Built knowledge graph for resource ${resourceId}`);\r\n  }\r\n\r\n  /**\r\n   * 创建资源节点\r\n   */\r\n  private async createResourceNode(resource: any): Promise<void> {\r\n    const existingNode = await this.neo4j.findNode('Resource', { id: resource.id });\r\n    if (existingNode) {\r\n      return;\r\n    }\r\n\r\n    await this.neo4j.createNode('Resource', {\r\n      id: resource.id,\r\n      type: resource.type,\r\n      title: resource.title,\r\n      abstract: resource.abstract?.substring(0, 500),\r\n      publishedAt: resource.publishedAt?.toISOString(),\r\n      qualityScore: resource.qualityScore,\r\n      createdAt: resource.createdAt.toISOString(),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 创建作者节点\r\n   */\r\n  private async createAuthorNode(author: { username: string; platform?: string }): Promise<void> {\r\n    const existingNode = await this.neo4j.findNode('Author', { username: author.username });\r\n    if (existingNode) {\r\n      return;\r\n    }\r\n\r\n    await this.neo4j.createNode('Author', {\r\n      username: author.username,\r\n      platform: author.platform || 'Unknown',\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 创建主题节点\r\n   */\r\n  private async createTopicNode(topic: string): Promise<void> {\r\n    const existingNode = await this.neo4j.findNode('Topic', { name: topic });\r\n    if (existingNode) {\r\n      return;\r\n    }\r\n\r\n    await this.neo4j.createNode('Topic', { name: topic });\r\n  }\r\n\r\n  /**\r\n   * 创建标签节点\r\n   */\r\n  private async createTagNode(tag: string): Promise<void> {\r\n    const existingNode = await this.neo4j.findNode('Tag', { name: tag });\r\n    if (existingNode) {\r\n      return;\r\n    }\r\n\r\n    await this.neo4j.createNode('Tag', { name: tag });\r\n  }\r\n\r\n  /**\r\n   * 链接资源和作者\r\n   */\r\n  private async linkResourceToAuthor(resourceId: string, authorUsername: string): Promise<void> {\r\n    try {\r\n      await this.neo4j.run(\r\n        `\r\n        MATCH (r:Resource {id: $resourceId})\r\n        MATCH (a:Author {username: $authorUsername})\r\n        MERGE (a)-[:AUTHORED]->(r)\r\n      `,\r\n        { resourceId, authorUsername },\r\n      );\r\n    } catch (error) {\r\n      this.logger.warn(`Failed to link resource to author: ${getErrorMessage(error)}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 链接资源和主题\r\n   */\r\n  private async linkResourceToTopic(resourceId: string, topicName: string): Promise<void> {\r\n    try {\r\n      await this.neo4j.run(\r\n        `\r\n        MATCH (r:Resource {id: $resourceId})\r\n        MATCH (t:Topic {name: $topicName})\r\n        MERGE (r)-[:BELONGS_TO]->(t)\r\n      `,\r\n        { resourceId, topicName },\r\n      );\r\n    } catch (error) {\r\n      this.logger.warn(`Failed to link resource to topic: ${getErrorMessage(error)}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 链接资源和标签\r\n   */\r\n  private async linkResourceToTag(resourceId: string, tagName: string): Promise<void> {\r\n    try {\r\n      await this.neo4j.run(\r\n        `\r\n        MATCH (r:Resource {id: $resourceId})\r\n        MATCH (t:Tag {name: $tagName})\r\n        MERGE (r)-[:TAGGED_WITH]->(t)\r\n      `,\r\n        { resourceId, tagName },\r\n      );\r\n    } catch (error) {\r\n      this.logger.warn(`Failed to link resource to tag: ${getErrorMessage(error)}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取资源的知识图谱\r\n   */\r\n  async getResourceGraph(resourceId: string, depth: number = 2): Promise<any> {\r\n    const result = await this.neo4j.run(\r\n      `\r\n      MATCH path = (r:Resource {id: $resourceId})-[*1..${depth}]-(n)\r\n      RETURN path\r\n      LIMIT 100\r\n    `,\r\n      { resourceId },\r\n    );\r\n\r\n    return this.formatGraphData(result);\r\n  }\r\n\r\n  /**\r\n   * 获取作者的知识图谱\r\n   */\r\n  async getAuthorGraph(authorUsername: string): Promise<any> {\r\n    const result = await this.neo4j.run(\r\n      `\r\n      MATCH path = (a:Author {username: $authorUsername})-[:AUTHORED]->(r:Resource)-[*0..1]-(n)\r\n      RETURN path\r\n      LIMIT 100\r\n    `,\r\n      { authorUsername },\r\n    );\r\n\r\n    return this.formatGraphData(result);\r\n  }\r\n\r\n  /**\r\n   * 获取主题的知识图谱\r\n   */\r\n  async getTopicGraph(topicName: string): Promise<any> {\r\n    const result = await this.neo4j.run(\r\n      `\r\n      MATCH path = (t:Topic {name: $topicName})<-[:BELONGS_TO]-(r:Resource)-[*0..1]-(n)\r\n      RETURN path\r\n      LIMIT 100\r\n    `,\r\n      { topicName },\r\n    );\r\n\r\n    return this.formatGraphData(result);\r\n  }\r\n\r\n  /**\r\n   * 获取整个知识图谱概览\r\n   */\r\n  async getGraphOverview(): Promise<any> {\r\n    const stats = await this.neo4j.run(`\r\n      MATCH (n)\r\n      RETURN labels(n)[0] as label, count(n) as count\r\n    `);\r\n\r\n    const relationships = await this.neo4j.run(`\r\n      MATCH ()-[r]->()\r\n      RETURN type(r) as type, count(r) as count\r\n    `);\r\n\r\n    return {\r\n      nodes: stats,\r\n      relationships: relationships,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 查找相似资源（基于共享的主题和标签）\r\n   */\r\n  async findSimilarResources(resourceId: string, limit: number = 10): Promise<any[]> {\r\n    const result = await this.neo4j.run(\r\n      `\r\n      MATCH (r1:Resource {id: $resourceId})-[:BELONGS_TO|TAGGED_WITH]->(common)<-[:BELONGS_TO|TAGGED_WITH]-(r2:Resource)\r\n      WHERE r1 <> r2\r\n      WITH r2, count(DISTINCT common) as commonCount\r\n      ORDER BY commonCount DESC\r\n      LIMIT $limit\r\n      RETURN r2, commonCount\r\n    `,\r\n      { resourceId, limit },\r\n    );\r\n\r\n    return result.map((record: { r2: { properties: unknown }, commonCount: number }) => ({\r\n      resource: record.r2.properties,\r\n      commonCount: record.commonCount,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * 格式化图数据为可视化格式\r\n   */\r\n  private formatGraphData(records: any[]): any {\r\n    const nodes = new Map();\r\n    const edges = [];\r\n\r\n    for (const record of records) {\r\n      if (record.path) {\r\n        const path = record.path;\r\n\r\n        // 提取节点\r\n        if (path.segments) {\r\n          for (const segment of path.segments) {\r\n            const start = segment.start;\r\n            const end = segment.end;\r\n\r\n            if (!nodes.has(start.identity.toString())) {\r\n              nodes.set(start.identity.toString(), {\r\n                id: start.identity.toString(),\r\n                label: start.labels[0],\r\n                properties: start.properties,\r\n              });\r\n            }\r\n\r\n            if (!nodes.has(end.identity.toString())) {\r\n              nodes.set(end.identity.toString(), {\r\n                id: end.identity.toString(),\r\n                label: end.labels[0],\r\n                properties: end.properties,\r\n              });\r\n            }\r\n\r\n            // 提取边\r\n            edges.push({\r\n              source: start.identity.toString(),\r\n              target: end.identity.toString(),\r\n              type: segment.relationship.type,\r\n              properties: segment.relationship.properties,\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      nodes: Array.from(nodes.values()),\r\n      edges: edges,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 批量构建知识图谱\r\n   */\r\n  async buildGraphForAllResources(): Promise<{ success: number; failed: number }> {\r\n    const resources = await this.prisma.resource.findMany({\r\n      select: { id: true },\r\n    });\r\n\r\n    let success = 0;\r\n    let failed = 0;\r\n\r\n    for (const resource of resources) {\r\n      try {\r\n        await this.buildGraphFromResource(resource.id);\r\n        success++;\r\n      } catch (error) {\r\n        this.logger.error(`Failed to build graph for ${resource.id}: ${getErrorMessage(error)}`);\r\n        failed++;\r\n      }\r\n    }\r\n\r\n    this.logger.log(`Built knowledge graph: ${success} success, ${failed} failed`);\r\n    return { success, failed };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\main.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":33,"column":41,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":33,"endColumn":43,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[824,826],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":36,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":36,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[865,936],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":14,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[940,1000],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":40,"column":1,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":40,"endColumn":13,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[1007,1007],"text":"void "},"desc":"Add void operator to ignore."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NestFactory } from '@nestjs/core';\r\nimport { ValidationPipe } from '@nestjs/common';\r\nimport { AppModule } from './app.module';\r\n// Force reload after CORS fix\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create(AppModule);\r\n\r\n  // 启用CORS - 允许所有localhost端口（开发环境）\r\n  app.enableCors({\r\n    origin: (origin, callback) => {\r\n      // 允许所有localhost端口和undefined（同源请求）\r\n      if (!origin || origin.match(/^http:\\/\\/localhost:\\d+$/)) {\r\n        callback(null, true);\r\n      } else {\r\n        callback(new Error('Not allowed by CORS'));\r\n      }\r\n    },\r\n    credentials: true,\r\n  });\r\n\r\n  // 启用全局验证管道\r\n  app.useGlobalPipes(\r\n    new ValidationPipe({\r\n      whitelist: true,\r\n      transform: true,\r\n    })\r\n  );\r\n\r\n  // API前缀\r\n  app.setGlobalPrefix('api/v1');\r\n\r\n  const port = process.env.BACKEND_PORT || 4000;\r\n  await app.listen(port);\r\n\r\n  console.log(`🚀 DeepDive Backend running on http://localhost:${port}`);\r\n  console.log(`📚 API Docs: http://localhost:${port}/api/v1`);\r\n}\r\n\r\nbootstrap();\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\proxy\\proxy.controller.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":87,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":87,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[2740,2742],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":192,"column":34,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":192,"endColumn":36,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[5858,5860],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Controller, Get, Query, Res, HttpException, HttpStatus } from '@nestjs/common';\r\nimport { Response } from 'express';\r\nimport axios from 'axios';\r\n\r\n/**\r\n * 代理控制器 - 用于代理外部资源（如 PDF），绕过 CORS 和 X-Frame-Options 限制\r\n */\r\n@Controller('proxy')\r\nexport class ProxyController {\r\n  /**\r\n   * 代理 PDF 文件\r\n   *\r\n   * 解决问题：\r\n   * 1. arXiv 等网站的 X-Frame-Options: DENY 阻止 iframe 嵌入\r\n   * 2. CORS 跨域限制\r\n   *\r\n   * 使用方式：\r\n   * http://localhost:4000/api/v1/proxy/pdf?url=https://arxiv.org/pdf/2511.04676v1\r\n   */\r\n  @Get('pdf')\r\n  async proxyPdf(\r\n    @Query('url') url: string,\r\n    @Res() res: Response,\r\n  ): Promise<void> {\r\n    if (!url) {\r\n      throw new HttpException('URL parameter is required', HttpStatus.BAD_REQUEST);\r\n    }\r\n\r\n    // 安全检查：只允许代理特定域名的 PDF\r\n    const allowedDomains = [\r\n      'arxiv.org',\r\n      'openreview.net',\r\n      'papers.nips.cc',\r\n      'proceedings.mlr.press',\r\n      'github.com',\r\n      'raw.githubusercontent.com',\r\n      'reddit.com',\r\n      'old.reddit.com',\r\n    ];\r\n\r\n    try {\r\n      const urlObj = new URL(url);\r\n      const isAllowed = allowedDomains.some(domain =>\r\n        urlObj.hostname === domain || urlObj.hostname.endsWith(`.${domain}`)\r\n      );\r\n\r\n      if (!isAllowed) {\r\n        throw new HttpException(\r\n          `Domain ${urlObj.hostname} is not allowed. Allowed domains: ${allowedDomains.join(', ')}`,\r\n          HttpStatus.FORBIDDEN,\r\n        );\r\n      }\r\n\r\n      // 从远程服务器获取 PDF\r\n      const response = await axios.get(url, {\r\n        responseType: 'arraybuffer',\r\n        timeout: 30000, // 30 seconds timeout\r\n        maxRedirects: 5, // 跟随重定向\r\n        headers: {\r\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\r\n          'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\r\n          'Accept-Language': 'en-US,en;q=0.5',\r\n          'Accept-Encoding': 'gzip, deflate, br',\r\n          'DNT': '1',\r\n          'Connection': 'keep-alive',\r\n          'Upgrade-Insecure-Requests': '1',\r\n        },\r\n      });\r\n\r\n      // 设置响应头，允许在 iframe 中显示\r\n      res.setHeader('Content-Type', 'application/pdf');\r\n      res.setHeader('Content-Disposition', 'inline');\r\n      // 关键：不设置 X-Frame-Options，允许 iframe 嵌入\r\n      res.setHeader('Access-Control-Allow-Origin', '*');\r\n      res.setHeader('Cache-Control', 'public, max-age=86400'); // 缓存 24 小时\r\n\r\n      // 发送 PDF 数据\r\n      res.send(Buffer.from(response.data));\r\n    } catch (error) {\r\n      if (error instanceof HttpException) {\r\n        throw error;\r\n      }\r\n\r\n      if (axios.isAxiosError(error)) {\r\n        throw new HttpException(\r\n          `Failed to fetch PDF: ${error.message}`,\r\n          error.response?.status || HttpStatus.BAD_GATEWAY,\r\n        );\r\n      }\r\n\r\n      throw new HttpException(\r\n        'Internal server error while proxying PDF',\r\n        HttpStatus.INTERNAL_SERVER_ERROR,\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 代理 HTML 页面\r\n   *\r\n   * 解决问题：\r\n   * 1. arXiv 等网站的 X-Frame-Options: SAMEORIGIN 阻止 iframe 嵌入\r\n   * 2. CORS 跨域限制\r\n   *\r\n   * 使用方式：\r\n   * http://localhost:4000/api/v1/proxy/html?url=https://arxiv.org/abs/2511.04675v1\r\n   */\r\n  @Get('html')\r\n  async proxyHtml(\r\n    @Query('url') url: string,\r\n    @Res() res: Response,\r\n  ): Promise<void> {\r\n    if (!url) {\r\n      throw new HttpException('URL parameter is required', HttpStatus.BAD_REQUEST);\r\n    }\r\n\r\n    // 安全检查：只允许代理特定域名\r\n    const allowedDomains = [\r\n      'arxiv.org',\r\n      'openreview.net',\r\n      'papers.nips.cc',\r\n      'proceedings.mlr.press',\r\n      'github.com',\r\n      'raw.githubusercontent.com',\r\n      'reddit.com',\r\n      'old.reddit.com',\r\n    ];\r\n\r\n    try {\r\n      const urlObj = new URL(url);\r\n      const isAllowed = allowedDomains.some(domain =>\r\n        urlObj.hostname === domain || urlObj.hostname.endsWith(`.${domain}`)\r\n      );\r\n\r\n      if (!isAllowed) {\r\n        throw new HttpException(\r\n          `Domain ${urlObj.hostname} is not allowed. Allowed domains: ${allowedDomains.join(', ')}`,\r\n          HttpStatus.FORBIDDEN,\r\n        );\r\n      }\r\n\r\n      // 从远程服务器获取 HTML\r\n      const response = await axios.get(url, {\r\n        responseType: 'text',\r\n        timeout: 30000,\r\n        maxRedirects: 5, // 跟随重定向\r\n        headers: {\r\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\r\n          'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\r\n          'Accept-Language': 'en-US,en;q=0.5',\r\n          'Accept-Encoding': 'gzip, deflate, br',\r\n          'Referer': 'https://www.reddit.com/',\r\n          'DNT': '1',\r\n          'Connection': 'keep-alive',\r\n          'Upgrade-Insecure-Requests': '1',\r\n        },\r\n      });\r\n\r\n      // 设置响应头，允许在 iframe 中显示\r\n      res.setHeader('Content-Type', 'text/html; charset=utf-8');\r\n      // 关键：不设置 X-Frame-Options，允许 iframe 嵌入\r\n      res.setHeader('Access-Control-Allow-Origin', '*');\r\n      res.setHeader('Cache-Control', 'public, max-age=3600'); // 缓存 1 小时\r\n\r\n      // 修改 HTML，添加 base 标签以正确加载资源\r\n      let html = response.data as string;\r\n      const baseUrl = `${urlObj.protocol}//${urlObj.hostname}`;\r\n\r\n      // 在 <head> 标签后插入 <base> 标签\r\n      if (html.includes('<head>')) {\r\n        html = html.replace(\r\n          '<head>',\r\n          `<head><base href=\"${baseUrl}/\">`\r\n        );\r\n      } else if (html.includes('<HEAD>')) {\r\n        html = html.replace(\r\n          '<HEAD>',\r\n          `<HEAD><base href=\"${baseUrl}/\">`\r\n        );\r\n      }\r\n\r\n      // 发送修改后的 HTML 数据\r\n      res.send(html);\r\n    } catch (error) {\r\n      if (error instanceof HttpException) {\r\n        throw error;\r\n      }\r\n\r\n      if (axios.isAxiosError(error)) {\r\n        throw new HttpException(\r\n          `Failed to fetch HTML: ${error.message}`,\r\n          error.response?.status || HttpStatus.BAD_GATEWAY,\r\n        );\r\n      }\r\n\r\n      throw new HttpException(\r\n        'Internal server error while proxying HTML',\r\n        HttpStatus.INTERNAL_SERVER_ERROR,\r\n      );\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\proxy\\proxy.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\recommendations\\recommendations.controller.ts","messages":[{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":30,"column":78,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":30,"endColumn":80,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[791,793],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  Controller,\r\n  Get,\r\n  Query,\r\n  Param,\r\n  Logger,\r\n  ParseIntPipe,\r\n  DefaultValuePipe,\r\n} from '@nestjs/common';\r\nimport { RecommendationsService } from './recommendations.service';\r\n\r\n/**\r\n * 推荐系统控制器\r\n */\r\n@Controller('recommendations')\r\nexport class RecommendationsController {\r\n  private readonly logger = new Logger(RecommendationsController.name);\r\n\r\n  constructor(private recommendationsService: RecommendationsService) {}\r\n\r\n  /**\r\n   * 获取个性化推荐\r\n   * GET /api/v1/recommendations/personalized?userId=xxx&limit=10\r\n   */\r\n  @Get('personalized')\r\n  async getPersonalized(\r\n    @Query('userId') userId?: string,\r\n    @Query('limit', new DefaultValuePipe(10), ParseIntPipe) limit?: number,\r\n  ) {\r\n    this.logger.log(`Fetching personalized recommendations (userId: ${userId || 'anonymous'})`);\r\n    return this.recommendationsService.getPersonalizedRecommendations(userId, limit);\r\n  }\r\n\r\n  /**\r\n   * 基于内容的推荐\r\n   * GET /api/v1/recommendations/content/:id?limit=10\r\n   */\r\n  @Get('content/:id')\r\n  async getContentBased(\r\n    @Param('id') id: string,\r\n    @Query('limit', new DefaultValuePipe(10), ParseIntPipe) limit?: number,\r\n  ) {\r\n    this.logger.log(`Fetching content-based recommendations for resource ${id}`);\r\n    return this.recommendationsService.getContentBasedRecommendations(id, limit);\r\n  }\r\n\r\n  /**\r\n   * 基于知识图谱的推荐\r\n   * GET /api/v1/recommendations/graph/:id?limit=10\r\n   */\r\n  @Get('graph/:id')\r\n  async getGraphBased(\r\n    @Param('id') id: string,\r\n    @Query('limit', new DefaultValuePipe(10), ParseIntPipe) limit?: number,\r\n  ) {\r\n    this.logger.log(`Fetching graph-based recommendations for resource ${id}`);\r\n    return this.recommendationsService.getGraphBasedRecommendations(id, limit);\r\n  }\r\n\r\n  /**\r\n   * 混合推荐\r\n   * GET /api/v1/recommendations/hybrid/:id?userId=xxx&limit=10\r\n   */\r\n  @Get('hybrid/:id')\r\n  async getHybrid(\r\n    @Param('id') id: string,\r\n    @Query('userId') userId?: string,\r\n    @Query('limit', new DefaultValuePipe(10), ParseIntPipe) limit?: number,\r\n  ) {\r\n    this.logger.log(`Fetching hybrid recommendations for resource ${id}`);\r\n    return this.recommendationsService.getHybridRecommendations(id, userId, limit);\r\n  }\r\n\r\n  /**\r\n   * 冷启动推荐（新用户）\r\n   * GET /api/v1/recommendations/cold-start?limit=10\r\n   */\r\n  @Get('cold-start')\r\n  async getColdStart(@Query('limit', new DefaultValuePipe(10), ParseIntPipe) limit?: number) {\r\n    this.logger.log('Fetching cold-start recommendations');\r\n    return this.recommendationsService.getColdStartRecommendations(limit);\r\n  }\r\n\r\n  /**\r\n   * 按类别推荐\r\n   * GET /api/v1/recommendations/category/:category?limit=10\r\n   */\r\n  @Get('category/:category')\r\n  async getByCategory(\r\n    @Param('category') category: string,\r\n    @Query('limit', new DefaultValuePipe(10), ParseIntPipe) limit?: number,\r\n  ) {\r\n    this.logger.log(`Fetching recommendations for category ${category}`);\r\n    return this.recommendationsService.getRecommendationsByCategory(category, limit);\r\n  }\r\n\r\n  /**\r\n   * 探索发现\r\n   * GET /api/v1/recommendations/explore?limit=10\r\n   */\r\n  @Get('explore')\r\n  async getExplore(@Query('limit', new DefaultValuePipe(10), ParseIntPipe) limit?: number) {\r\n    this.logger.log('Fetching explore recommendations');\r\n    return this.recommendationsService.getExploreRecommendations(limit);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\recommendations\\recommendations.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\recommendations\\recommendations.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[611,614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[611,614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[956,959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[956,959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":57,"column":46,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":57,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":57,"column":48,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":57,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any[]` typed value.","line":61,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":67,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":63,"column":35,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":63,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .qualityScore on an `any` value.","line":63,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":63,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":63,"column":71,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":63,"endColumn":93},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .trendingScore on an `any` value.","line":63,"column":73,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":63,"endColumn":86},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":64,"column":35,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":64,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .qualityScore on an `any` value.","line":64,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":64,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":64,"column":71,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":64,"endColumn":93},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .trendingScore on an `any` value.","line":64,"column":73,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":64,"endColumn":86},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2110,2113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2110,2113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2518,2521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2518,2521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3747,3750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3747,3750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":141,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":151,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":153,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":153,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":158,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":158,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":158,"column":27,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":158,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .map on an `any` value.","line":158,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":158,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":161,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":161,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":166,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":166,"endColumn":98},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":166,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":166,"endColumn":88},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":166,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":166,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .map on an `any` value.","line":166,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":166,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .filter on an `any` value.","line":166,"column":82,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":166,"endColumn":88},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5001,5004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5001,5004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":195,"column":32,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":195,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .qualityScore on an `any` value.","line":195,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":195,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":196,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":196,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":196,"column":38,"nodeType":"Property","messageId":"anyAssignment","endLine":196,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":201,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":201,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":202,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":202,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":202,"column":51,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":202,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .score on an `any` value.","line":203,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":203,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":203,"column":38,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":203,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .qualityScore on an `any` value.","line":203,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":203,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":205,"column":34,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":205,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .qualityScore on an `any` value.","line":205,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":205,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":206,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":206,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":206,"column":40,"nodeType":"Property","messageId":"anyAssignment","endLine":206,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":212,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":212,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":213,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":213,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":213,"column":51,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":213,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .score on an `any` value.","line":214,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":214,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":214,"column":38,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":214,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .trendingScore on an `any` value.","line":214,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":214,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `string`.","line":216,"column":34,"nodeType":"LogicalExpression","messageId":"unsafeArgument","endLine":216,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .trendingScore on an `any` value.","line":216,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":216,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .id on an `any` value.","line":217,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":217,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":217,"column":40,"nodeType":"Property","messageId":"anyAssignment","endLine":217,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .score on an `any` value.","line":226,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":226,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .score on an `any` value.","line":226,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":226,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":228,"column":22,"nodeType":"MemberExpression","messageId":"unsafeReturn","endLine":228,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .resource on an `any` value.","line":228,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":228,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any[]` typed value.","line":230,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":230,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6783,6786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6783,6786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":258,"column":61,"nodeType":"Property","messageId":"anyAssignment","endLine":258,"endColumn":78},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":258,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7508,7511],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7508,7511],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":285,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":285,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8147,8150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8147,8150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8590,8593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8590,8593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":321,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":321,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9058,9061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9058,9061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":63,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, Logger } from '@nestjs/common';\r\nimport { PrismaService } from '../common/prisma/prisma.service';\r\nimport { Neo4jService } from '../common/neo4j/neo4j.service';\r\nimport { getErrorMessage } from '../common/utils/error.utils';\r\n\r\n/**\r\n * 推荐系统服务\r\n */\r\n@Injectable()\r\nexport class RecommendationsService {\r\n  private readonly logger = new Logger(RecommendationsService.name);\r\n\r\n  constructor(\r\n    private prisma: PrismaService,\r\n    private neo4j: Neo4jService,\r\n  ) {}\r\n\r\n  /**\r\n   * 获取个性化推荐（混合推荐）\r\n   */\r\n  async getPersonalizedRecommendations(userId?: string, limit: number = 10): Promise<any[]> {\r\n    if (userId) {\r\n      // 基于用户历史的个性化推荐\r\n      return this.getUserBasedRecommendations(userId, limit);\r\n    } else {\r\n      // 未登录用户：基于热门度和质量分的推荐\r\n      return this.getPopularRecommendations(limit);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 基于用户行为的推荐（协同过滤）\r\n   */\r\n  private async getUserBasedRecommendations(userId: string, limit: number): Promise<any[]> {\r\n    // 1. 获取用户浏览/收藏过的资源\r\n    const userActivities = await this.prisma.userActivity.findMany({\r\n      where: { userId },\r\n      orderBy: { createdAt: 'desc' },\r\n      take: 20,\r\n      select: {\r\n        resourceId: true,\r\n      },\r\n    });\r\n\r\n    if (userActivities.length === 0) {\r\n      return this.getPopularRecommendations(limit);\r\n    }\r\n\r\n    // 2. 提取用户感兴趣的资源ID\r\n    const interestedResourceIds = userActivities.map((a) => a.resourceId);\r\n\r\n    // 3. 基于这些资源找相似资源\r\n    const similarResources = await this.findSimilarResources(interestedResourceIds, limit * 2);\r\n\r\n    // 4. 过滤掉用户已经看过的\r\n    const recommendations = similarResources.filter(\r\n      (r) => !interestedResourceIds.includes(r.id),\r\n    );\r\n\r\n    // 5. 按质量分和趋势分排序\r\n    return recommendations\r\n      .sort((a, b) => {\r\n        const scoreA = parseFloat(a.qualityScore || '0') + parseFloat(a.trendingScore || '0');\r\n        const scoreB = parseFloat(b.qualityScore || '0') + parseFloat(b.trendingScore || '0');\r\n        return scoreB - scoreA;\r\n      })\r\n      .slice(0, limit);\r\n  }\r\n\r\n  /**\r\n   * 基于热门度的推荐\r\n   */\r\n  private async getPopularRecommendations(limit: number): Promise<any[]> {\r\n    const resources = await this.prisma.resource.findMany({\r\n      take: limit,\r\n      orderBy: [{ trendingScore: 'desc' }, { qualityScore: 'desc' }],\r\n      where: {\r\n        qualityScore: {\r\n          gte: '50',\r\n        },\r\n      },\r\n    });\r\n\r\n    return resources;\r\n  }\r\n\r\n  /**\r\n   * 基于内容的相似资源推荐\r\n   */\r\n  async getContentBasedRecommendations(resourceId: string, limit: number = 10): Promise<any[]> {\r\n    const resource = await this.prisma.resource.findUnique({\r\n      where: { id: resourceId },\r\n      select: {\r\n        type: true,\r\n        categories: true,\r\n        tags: true,\r\n        primaryCategory: true,\r\n      },\r\n    });\r\n\r\n    if (!resource) {\r\n      return [];\r\n    }\r\n\r\n    // 查找相同类型、相似类别和标签的资源\r\n    const similarResources = await this.prisma.resource.findMany({\r\n      where: {\r\n        id: { not: resourceId },\r\n        type: resource.type,\r\n        OR: [\r\n          ...(Array.isArray(resource.categories)\r\n            ? (resource.categories as string[]).map((cat) => ({\r\n                categories: { array_contains: cat },\r\n              }))\r\n            : []),\r\n          ...(Array.isArray(resource.tags)\r\n            ? (resource.tags as string[]).map((tag) => ({\r\n                tags: { array_contains: tag },\r\n              }))\r\n            : []),\r\n          {\r\n            primaryCategory: resource.primaryCategory,\r\n          },\r\n        ],\r\n      },\r\n      take: limit,\r\n      orderBy: {\r\n        qualityScore: 'desc',\r\n      },\r\n    });\r\n\r\n    return similarResources;\r\n  }\r\n\r\n  /**\r\n   * 基于知识图谱的推荐\r\n   */\r\n  async getGraphBasedRecommendations(resourceId: string, limit: number = 10): Promise<any[]> {\r\n    try {\r\n      // 通过 Neo4j 找到相关的资源\r\n      const result = await this.neo4j.run(\r\n        `\r\n        MATCH (r1:Resource {id: $resourceId})-[:BELONGS_TO|TAGGED_WITH|AUTHORED]->(common)<-[:BELONGS_TO|TAGGED_WITH|AUTHORED]-(r2:Resource)\r\n        WHERE r1 <> r2\r\n        WITH r2, count(DISTINCT common) as commonCount\r\n        ORDER BY commonCount DESC\r\n        LIMIT $limit\r\n        RETURN r2.id as id, commonCount\r\n      `,\r\n        { resourceId, limit },\r\n      );\r\n\r\n      if (result.length === 0) {\r\n        return [];\r\n      }\r\n\r\n      // 从 PostgreSQL 获取完整资源信息\r\n      const resourceIds = result.map((r: { id: string }) => r.id);\r\n      const resources = await this.prisma.resource.findMany({\r\n        where: {\r\n          id: { in: resourceIds },\r\n        },\r\n      });\r\n\r\n      // 按照 Neo4j 返回的顺序排序\r\n      return resourceIds.map((id: string) => resources.find((r) => r.id === id)).filter(Boolean);\r\n    } catch (error) {\r\n      this.logger.warn(`Graph-based recommendation failed: ${getErrorMessage(error)}`);\r\n      return this.getContentBasedRecommendations(resourceId, limit);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 混合推荐算法\r\n   */\r\n  async getHybridRecommendations(\r\n    resourceId: string,\r\n    _userId?: string,\r\n    limit: number = 10,\r\n  ): Promise<any[]> {\r\n    // 1. 基于内容的推荐（权重40%）\r\n    const contentBased = await this.getContentBasedRecommendations(resourceId, limit);\r\n\r\n    // 2. 基于图谱的推荐（权重40%）\r\n    const graphBased = await this.getGraphBasedRecommendations(resourceId, limit);\r\n\r\n    // 3. 热门推荐（权重20%）\r\n    const popular = await this.getPopularRecommendations(Math.floor(limit / 2));\r\n\r\n    // 合并并去重\r\n    const allRecommendations = new Map();\r\n\r\n    // 添加基于内容的推荐（分数 = 质量分 * 0.4）\r\n    contentBased.forEach((r) => {\r\n      const score = parseFloat(r.qualityScore || '0') * 0.4;\r\n      allRecommendations.set(r.id, { resource: r, score });\r\n    });\r\n\r\n    // 添加基于图谱的推荐（分数 = 质量分 * 0.4）\r\n    graphBased.forEach((r) => {\r\n      if (allRecommendations.has(r.id)) {\r\n        const existing = allRecommendations.get(r.id);\r\n        existing.score += parseFloat(r.qualityScore || '0') * 0.4;\r\n      } else {\r\n        const score = parseFloat(r.qualityScore || '0') * 0.4;\r\n        allRecommendations.set(r.id, { resource: r, score });\r\n      }\r\n    });\r\n\r\n    // 添加热门推荐（分数 = 趋势分 * 0.2）\r\n    popular.forEach((r) => {\r\n      if (allRecommendations.has(r.id)) {\r\n        const existing = allRecommendations.get(r.id);\r\n        existing.score += parseFloat(r.trendingScore || '0') * 0.2;\r\n      } else {\r\n        const score = parseFloat(r.trendingScore || '0') * 0.2;\r\n        allRecommendations.set(r.id, { resource: r, score });\r\n      }\r\n    });\r\n\r\n    // 排除当前资源\r\n    allRecommendations.delete(resourceId);\r\n\r\n    // 排序并返回\r\n    const sorted = Array.from(allRecommendations.values())\r\n      .sort((a, b) => b.score - a.score)\r\n      .slice(0, limit)\r\n      .map((item) => item.resource);\r\n\r\n    return sorted;\r\n  }\r\n\r\n  /**\r\n   * 查找相似资源（辅助方法）\r\n   */\r\n  private async findSimilarResources(resourceIds: string[], limit: number): Promise<any[]> {\r\n    // 获取这些资源的所有类别和标签\r\n    const resources = await this.prisma.resource.findMany({\r\n      where: { id: { in: resourceIds } },\r\n      select: { categories: true, tags: true, type: true },\r\n    });\r\n\r\n    const allCategories = new Set<string>();\r\n    const allTags = new Set<string>();\r\n    const types = new Set<string>();\r\n\r\n    resources.forEach((r) => {\r\n      if (Array.isArray(r.categories)) {\r\n        (r.categories as string[]).forEach((c) => allCategories.add(c));\r\n      }\r\n      if (Array.isArray(r.tags)) {\r\n        (r.tags as string[]).forEach((t) => allTags.add(t));\r\n      }\r\n      types.add(r.type);\r\n    });\r\n\r\n    // 查找相似资源\r\n    const typeConditions = Array.from(types).map(type => ({ type: type as any }));\r\n\r\n    const similar = await this.prisma.resource.findMany({\r\n      where: {\r\n        id: { notIn: resourceIds },\r\n        OR: [\r\n          ...typeConditions,\r\n          ...Array.from(allCategories).map((cat) => ({\r\n            categories: { array_contains: cat },\r\n          })),\r\n          ...Array.from(allTags).map((tag) => ({\r\n            tags: { array_contains: tag },\r\n          })),\r\n        ],\r\n      },\r\n      take: limit,\r\n      orderBy: {\r\n        qualityScore: 'desc',\r\n      },\r\n    });\r\n\r\n    return similar;\r\n  }\r\n\r\n  /**\r\n   * 冷启动推荐（新用户推荐）\r\n   */\r\n  async getColdStartRecommendations(limit: number = 10): Promise<any[]> {\r\n    // 推荐高质量、热门的资源\r\n    const resources = await this.prisma.resource.findMany({\r\n      where: {\r\n        qualityScore: {\r\n          gte: '70',\r\n        },\r\n      },\r\n      take: limit,\r\n      orderBy: [{ trendingScore: 'desc' }, { qualityScore: 'desc' }, { publishedAt: 'desc' }],\r\n    });\r\n\r\n    return resources;\r\n  }\r\n\r\n  /**\r\n   * 按类别推荐\r\n   */\r\n  async getRecommendationsByCategory(category: string, limit: number = 10): Promise<any[]> {\r\n    const resources = await this.prisma.resource.findMany({\r\n      where: {\r\n        OR: [\r\n          { primaryCategory: category },\r\n          { categories: { array_contains: category } },\r\n        ],\r\n      },\r\n      take: limit,\r\n      orderBy: [{ qualityScore: 'desc' }, { trendingScore: 'desc' }],\r\n    });\r\n\r\n    return resources;\r\n  }\r\n\r\n  /**\r\n   * 探索发现（diverse recommendations）\r\n   */\r\n  async getExploreRecommendations(limit: number = 10): Promise<any[]> {\r\n    // 从不同类别中各选一些高质量资源\r\n    const categories = ['AI', 'ML', 'Web', 'Backend', 'Frontend', 'DevOps', 'Data', 'Security'];\r\n    const perCategory = Math.ceil(limit / categories.length);\r\n\r\n    const recommendations = [];\r\n\r\n    for (const category of categories) {\r\n      const resources = await this.prisma.resource.findMany({\r\n        where: {\r\n          OR: [\r\n            { primaryCategory: category },\r\n            { categories: { array_contains: category } },\r\n          ],\r\n        },\r\n        take: perCategory,\r\n        orderBy: {\r\n          qualityScore: 'desc',\r\n        },\r\n      });\r\n\r\n      recommendations.push(...resources);\r\n    }\r\n\r\n    // 打乱顺序\r\n    return recommendations.sort(() => Math.random() - 0.5).slice(0, limit);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\resources\\ai-enrichment.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":40,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":40,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .summary on an `any` value.","line":40,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":40,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .model_used on an `any` value.","line":41,"column":64,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":41,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":43,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":43,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1620,1623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1620,1623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":62,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":62,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .insights on an `any` value.","line":62,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":62,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .length on an `any` value.","line":63,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":63,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .model_used on an `any` value.","line":63,"column":84,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":63,"endColumn":94},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":1,"message":"Unsafe return of an `any` typed value.","line":65,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":65,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":89,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":89,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .category on an `any` value.","line":89,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":89,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":90,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":90,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .subcategories on an `any` value.","line":90,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":90,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":91,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":91,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .tags on an `any` value.","line":91,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":91,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":92,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":92,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .difficulty_level on an `any` value.","line":92,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":92,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3334,3337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3334,3337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":139,"column":29,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":139,"endColumn":31,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[4093,4095],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":140,"column":49,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":140,"endColumn":51,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[4149,4151],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":141,"column":38,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":141,"endColumn":40,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[4196,4198],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .status on an `any` value.","line":209,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":209,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .status on an `any` value.","line":209,"column":72,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":209,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .status on an `any` value.","line":210,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":210,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .active_model on an `any` value.","line":210,"column":84,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":210,"endColumn":96}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":26,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, Logger } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { getErrorMessage } from '../common/utils/error.utils';\r\nimport axios, { AxiosInstance } from 'axios';\r\n\r\n/**\r\n * AI 增强服务\r\n * 负责调用 AI 服务进行内容摘要、洞察提取和分类\r\n */\r\n@Injectable()\r\nexport class AIEnrichmentService {\r\n  private readonly logger = new Logger(AIEnrichmentService.name);\r\n  private readonly aiServiceUrl: string;\r\n  private readonly httpClient: AxiosInstance;\r\n\r\n  constructor(private configService: ConfigService) {\r\n    this.aiServiceUrl = this.configService.get<string>('AI_SERVICE_URL', 'http://localhost:5000');\r\n    this.httpClient = axios.create({\r\n      baseURL: this.aiServiceUrl,\r\n      timeout: 30000, // 30秒超时\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 生成内容摘要\r\n   */\r\n  async generateSummary(content: string, maxLength = 200, language: 'zh' | 'en' = 'zh'): Promise<string | null> {\r\n    try {\r\n      this.logger.log(`Generating summary for content (length: ${content.length})`);\r\n\r\n      const response = await this.httpClient.post('/api/v1/ai/summary', {\r\n        content,\r\n        max_length: maxLength,\r\n        language,\r\n      });\r\n\r\n      const summary = response.data.summary;\r\n      this.logger.log(`Summary generated using ${response.data.model_used}`);\r\n\r\n      return summary;\r\n    } catch (error) {\r\n      this.logger.error(`Failed to generate summary: ${getErrorMessage(error)}`);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 提取关键洞察\r\n   */\r\n  async extractInsights(content: string, language: 'zh' | 'en' = 'zh'): Promise<any[] | null> {\r\n    try {\r\n      this.logger.log(`Extracting insights for content (length: ${content.length})`);\r\n\r\n      const response = await this.httpClient.post('/api/v1/ai/insights', {\r\n        content,\r\n        language,\r\n      });\r\n\r\n      const insights = response.data.insights;\r\n      this.logger.log(`Extracted ${insights.length} insights using ${response.data.model_used}`);\r\n\r\n      return insights;\r\n    } catch (error) {\r\n      this.logger.error(`Failed to extract insights: ${getErrorMessage(error)}`);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 分类内容\r\n   */\r\n  async classifyContent(content: string): Promise<{\r\n    category: string;\r\n    subcategories: string[];\r\n    tags: string[];\r\n    difficultyLevel: string;\r\n  } | null> {\r\n    try {\r\n      this.logger.log(`Classifying content (length: ${content.length})`);\r\n\r\n      const response = await this.httpClient.post('/api/v1/ai/classify', {\r\n        content,\r\n      });\r\n\r\n      const classification = {\r\n        category: response.data.category,\r\n        subcategories: response.data.subcategories,\r\n        tags: response.data.tags,\r\n        difficultyLevel: response.data.difficulty_level,\r\n      };\r\n\r\n      this.logger.log(`Content classified as ${classification.category} (${classification.difficultyLevel})`);\r\n\r\n      return classification;\r\n    } catch (error) {\r\n      this.logger.error(`Failed to classify content: ${getErrorMessage(error)}`);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 完整的 AI 增强处理\r\n   * 对资源内容进行摘要、洞察提取和分类\r\n   */\r\n  async enrichResource(resource: {\r\n    title: string;\r\n    abstract?: string;\r\n    content?: string;\r\n    sourceUrl?: string;\r\n  }): Promise<{\r\n    aiSummary: string | null;\r\n    keyInsights: any[];\r\n    primaryCategory: string | null;\r\n    autoTags: string[];\r\n    difficultyLevel: number | null;\r\n  }> {\r\n    // 构建用于 AI 分析的内容\r\n    const contentForAI = this.buildContentForAI(resource);\r\n\r\n    this.logger.log(`Enriching resource: ${resource.title}`);\r\n\r\n    // 并行调用所有 AI 服务\r\n    const [summary, insights, classification] = await Promise.all([\r\n      this.generateSummary(contentForAI, 200, 'zh'),\r\n      this.extractInsights(contentForAI, 'zh'),\r\n      this.classifyContent(contentForAI),\r\n    ]);\r\n\r\n    // 将难度等级字符串转换为数字\r\n    const difficultyLevelNum = classification?.difficultyLevel\r\n      ? this.mapDifficultyToNumber(classification.difficultyLevel)\r\n      : null;\r\n\r\n    const result = {\r\n      aiSummary: summary,\r\n      keyInsights: insights || [],\r\n      primaryCategory: classification?.category || null,\r\n      autoTags: classification?.tags || [],\r\n      difficultyLevel: difficultyLevelNum,\r\n    };\r\n\r\n    this.logger.log(`Resource enrichment completed: ${result.aiSummary ? 'summary ✓' : 'summary ✗'}, ${result.keyInsights.length} insights, ${result.autoTags.length} tags`);\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * 将难度等级字符串映射为数字\r\n   */\r\n  private mapDifficultyToNumber(difficulty: string): number {\r\n    const mapping: Record<string, number> = {\r\n      beginner: 1,\r\n      intermediate: 2,\r\n      advanced: 3,\r\n      expert: 4,\r\n    };\r\n\r\n    return mapping[difficulty.toLowerCase()] || 2; // 默认为 intermediate\r\n  }\r\n\r\n  /**\r\n   * 构建用于 AI 分析的内容\r\n   * 组合标题、摘要和内容\r\n   */\r\n  private buildContentForAI(resource: {\r\n    title: string;\r\n    abstract?: string;\r\n    content?: string;\r\n    sourceUrl?: string;\r\n  }): string {\r\n    const parts: string[] = [];\r\n\r\n    // 标题\r\n    if (resource.title) {\r\n      parts.push(`标题: ${resource.title}`);\r\n    }\r\n\r\n    // 摘要\r\n    if (resource.abstract) {\r\n      parts.push(`摘要: ${resource.abstract}`);\r\n    }\r\n\r\n    // 内容（截取前2000字符以控制成本）\r\n    if (resource.content) {\r\n      const truncatedContent = resource.content.substring(0, 2000);\r\n      parts.push(`内容: ${truncatedContent}${resource.content.length > 2000 ? '...' : ''}`);\r\n    }\r\n\r\n    // URL 作为补充信息\r\n    if (resource.sourceUrl) {\r\n      parts.push(`来源: ${resource.sourceUrl}`);\r\n    }\r\n\r\n    return parts.join('\\n\\n');\r\n  }\r\n\r\n  /**\r\n   * 检查 AI 服务健康状态\r\n   */\r\n  async checkHealth(): Promise<boolean> {\r\n    try {\r\n      const response = await this.httpClient.get('/api/v1/ai/health', {\r\n        timeout: 5000,\r\n      });\r\n\r\n      const isHealthy = response.data.status === 'ok' || response.data.status === 'degraded';\r\n      this.logger.log(`AI service health: ${response.data.status} (${response.data.active_model})`);\r\n\r\n      return isHealthy;\r\n    } catch (error) {\r\n      this.logger.error(`AI service health check failed: ${getErrorMessage(error)}`);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\resources\\pdf-thumbnail.service.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":6,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":6,"endColumn":54,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[213,266],"text":"// @ts-expect-error - pdfjs-dist types may not be available"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":23,"column":5,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":23,"endColumn":37,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[783,783],"text":"void "},"desc":"Add void operator to ignore."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":56,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":56,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":56,"column":27,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":56,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .getDocument on an `any` value.","line":56,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":56,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":57,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":57,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .promise on an `any` value.","line":57,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":57,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":60,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":60,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":60,"column":26,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":60,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .getPage on an `any` value.","line":60,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":60,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":63,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":63,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":63,"column":24,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":63,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .getViewport on an `any` value.","line":63,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":63,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .width on an `any` value.","line":65,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":65,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .height on an `any` value.","line":66,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":66,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":68,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":68,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":68,"column":30,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":68,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .getViewport on an `any` value.","line":68,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":68,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `number`.","line":71,"column":35,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":71,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .width on an `any` value.","line":71,"column":50,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":71,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `number`.","line":71,"column":57,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":71,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .height on an `any` value.","line":71,"column":72,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":71,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":76,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":76,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2434,2437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2434,2437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":77,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":77,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe call of an `any` typed value.","line":79,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":79,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .render on an `any` value.","line":79,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":79,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .promise on an `any` value.","line":79,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":79,"endColumn":47}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":26,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, Logger } from '@nestjs/common';\r\nimport { getErrorMessage } from '../common/utils/error.utils';\r\nimport * as fs from 'fs/promises';\r\nimport * as path from 'path';\r\nimport axios from 'axios';\r\n// @ts-ignore - pdfjs-dist types may not be available\r\nimport * as pdfjsLib from 'pdfjs-dist/legacy/build/pdf';\r\nimport { createCanvas } from 'canvas';\r\nimport sharp from 'sharp';\r\n\r\n/**\r\n * PDF缩略图生成服务\r\n * 从PDF URL生成缩略图并保存到本地\r\n */\r\n@Injectable()\r\nexport class PdfThumbnailService {\r\n  private readonly logger = new Logger(PdfThumbnailService.name);\r\n  private readonly thumbnailDir = path.join(process.cwd(), 'public', 'thumbnails');\r\n  private readonly thumbnailWidth = 400; // 缩略图宽度\r\n  private readonly thumbnailHeight = 566; // 缩略图高度 (A4比例)\r\n\r\n  constructor() {\r\n    this.ensureThumbnailDirExists();\r\n  }\r\n\r\n  /**\r\n   * 确保缩略图目录存在\r\n   */\r\n  private async ensureThumbnailDirExists() {\r\n    try {\r\n      await fs.mkdir(this.thumbnailDir, { recursive: true });\r\n      this.logger.log(`Thumbnail directory ensured at: ${this.thumbnailDir}`);\r\n    } catch (error) {\r\n      this.logger.error('Failed to create thumbnail directory:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 从PDF URL生成缩略图\r\n   * @param pdfUrl PDF文件URL\r\n   * @param resourceId 资源ID (用于文件命名)\r\n   * @returns 缩略图URL\r\n   */\r\n  async generateThumbnail(pdfUrl: string, resourceId: string): Promise<string | null> {\r\n    try {\r\n      this.logger.log(`Generating thumbnail for resource ${resourceId} from ${pdfUrl}`);\r\n\r\n      // 1. 下载PDF\r\n      const pdfData = await this.downloadPdf(pdfUrl);\r\n      if (!pdfData) {\r\n        this.logger.warn(`Failed to download PDF for resource ${resourceId}`);\r\n        return null;\r\n      }\r\n\r\n      // 2. 加载PDF文档\r\n      const loadingTask = pdfjsLib.getDocument({ data: pdfData });\r\n      const pdfDocument = await loadingTask.promise;\r\n\r\n      // 3. 获取第一页\r\n      const page = await pdfDocument.getPage(1);\r\n\r\n      // 4. 设置缩放比例以匹配目标尺寸\r\n      const viewport = page.getViewport({ scale: 1.0 });\r\n      const scale = Math.min(\r\n        this.thumbnailWidth / viewport.width,\r\n        this.thumbnailHeight / viewport.height\r\n      );\r\n      const scaledViewport = page.getViewport({ scale });\r\n\r\n      // 5. 创建canvas\r\n      const canvas = createCanvas(scaledViewport.width, scaledViewport.height);\r\n      const context = canvas.getContext('2d');\r\n\r\n      // 6. 渲染PDF页面到canvas\r\n      const renderContext = {\r\n        canvasContext: context as any,\r\n        viewport: scaledViewport,\r\n      };\r\n      await page.render(renderContext).promise;\r\n\r\n      // 7. 转换为buffer\r\n      const buffer = canvas.toBuffer('image/png');\r\n\r\n      // 8. 使用sharp优化图片（可选：压缩、调整大小）\r\n      const optimizedBuffer = await sharp(buffer)\r\n        .resize(this.thumbnailWidth, this.thumbnailHeight, {\r\n          fit: 'inside',\r\n          withoutEnlargement: true,\r\n        })\r\n        .jpeg({ quality: 85 })\r\n        .toBuffer();\r\n\r\n      // 9. 保存到文件\r\n      const filename = `${resourceId}.jpg`;\r\n      const filepath = path.join(this.thumbnailDir, filename);\r\n      await fs.writeFile(filepath, optimizedBuffer);\r\n\r\n      this.logger.log(`Thumbnail generated successfully for resource ${resourceId}`);\r\n\r\n      // 10. 返回相对URL\r\n      return `/thumbnails/${filename}`;\r\n    } catch (error) {\r\n      this.logger.error(\r\n        `Failed to generate thumbnail for resource ${resourceId}:`,\r\n        getErrorMessage(error)\r\n      );\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 下载PDF文件\r\n   * @param url PDF URL\r\n   * @returns PDF数据buffer\r\n   */\r\n  private async downloadPdf(url: string): Promise<Buffer | null> {\r\n    try {\r\n      const response = await axios.get(url, {\r\n        responseType: 'arraybuffer',\r\n        timeout: 30000, // 30秒超时\r\n        headers: {\r\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\r\n        },\r\n      });\r\n\r\n      return Buffer.from(response.data);\r\n    } catch (error) {\r\n      this.logger.error(`Failed to download PDF from ${url}:`, getErrorMessage(error));\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 检查缩略图是否存在\r\n   * @param resourceId 资源ID\r\n   * @returns 是否存在\r\n   */\r\n  async thumbnailExists(resourceId: string): Promise<boolean> {\r\n    try {\r\n      const filename = `${resourceId}.jpg`;\r\n      const filepath = path.join(this.thumbnailDir, filename);\r\n      await fs.access(filepath);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 删除缩略图\r\n   * @param resourceId 资源ID\r\n   */\r\n  async deleteThumbnail(resourceId: string): Promise<void> {\r\n    try {\r\n      const filename = `${resourceId}.jpg`;\r\n      const filepath = path.join(this.thumbnailDir, filename);\r\n      await fs.unlink(filepath);\r\n      this.logger.log(`Deleted thumbnail for resource ${resourceId}`);\r\n    } catch (error) {\r\n      this.logger.warn(`Failed to delete thumbnail for resource ${resourceId}:`, getErrorMessage(error));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 批量生成缩略图\r\n   * @param resources 包含pdfUrl和id的资源列表\r\n   * @returns 生成结果统计\r\n   */\r\n  async generateBatchThumbnails(\r\n    resources: Array<{ id: string; pdfUrl: string }>\r\n  ): Promise<{ success: number; failed: number; skipped: number }> {\r\n    const stats = { success: 0, failed: 0, skipped: 0 };\r\n\r\n    for (const resource of resources) {\r\n      // 检查是否已有缩略图\r\n      if (await this.thumbnailExists(resource.id)) {\r\n        this.logger.log(`Thumbnail already exists for resource ${resource.id}, skipping`);\r\n        stats.skipped++;\r\n        continue;\r\n      }\r\n\r\n      // 生成缩略图\r\n      const thumbnailUrl = await this.generateThumbnail(resource.pdfUrl, resource.id);\r\n      if (thumbnailUrl) {\r\n        stats.success++;\r\n      } else {\r\n        stats.failed++;\r\n      }\r\n\r\n      // 添加延迟避免过快请求\r\n      await new Promise((resolve) => setTimeout(resolve, 500));\r\n    }\r\n\r\n    this.logger.log(\r\n      `Batch thumbnail generation completed: ${stats.success} success, ${stats.failed} failed, ${stats.skipped} skipped`\r\n    );\r\n\r\n    return stats;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\resources\\resources.controller.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":194,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":194,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":194,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4952,4955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4952,4955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-misused-promises","severity":2,"message":"Promise-returning function provided to property where a void return was expected.","line":215,"column":22,"nodeType":"ArrowFunctionExpression","messageId":"voidReturnProperty","endLine":223,"endColumn":10}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Patch,\r\n  Delete,\r\n  Body,\r\n  Param,\r\n  Query,\r\n  Logger,\r\n  ParseIntPipe,\r\n  DefaultValuePipe,\r\n  HttpException,\r\n  HttpStatus,\r\n  UploadedFile,\r\n  UseInterceptors,\r\n} from '@nestjs/common';\r\nimport { FileInterceptor } from '@nestjs/platform-express';\r\nimport { diskStorage } from 'multer';\r\nimport * as path from 'path';\r\nimport * as fs from 'fs/promises';\r\nimport { ResourcesService } from './resources.service';\r\nimport { AIEnrichmentService } from './ai-enrichment.service';\r\n// import { PdfThumbnailService } from './pdf-thumbnail.service';\r\nimport { Prisma } from '@prisma/client';\r\n\r\n/**\r\n * 资源管理控制器\r\n */\r\n@Controller('resources')\r\nexport class ResourcesController {\r\n  private readonly logger = new Logger(ResourcesController.name);\r\n\r\n  constructor(\r\n    private resourcesService: ResourcesService,\r\n    private aiEnrichmentService: AIEnrichmentService,\r\n    // private pdfThumbnailService: PdfThumbnailService,\r\n  ) {}\r\n\r\n  /**\r\n   * 获取资源列表\r\n   * GET /api/v1/resources?skip=0&take=20&type=PAPER&category=AI&search=machine+learning&sortBy=publishedAt&sortOrder=desc\r\n   */\r\n  @Get()\r\n  async findAll(\r\n    @Query('skip', new DefaultValuePipe(0), ParseIntPipe) skip: number,\r\n    @Query('take', new DefaultValuePipe(20), ParseIntPipe) take: number,\r\n    @Query('type') type?: string,\r\n    @Query('category') category?: string,\r\n    @Query('search') search?: string,\r\n    @Query('sortBy') sortBy?: 'publishedAt' | 'qualityScore' | 'trendingScore',\r\n    @Query('sortOrder') sortOrder?: 'asc' | 'desc',\r\n  ) {\r\n    this.logger.log(`Fetching resources (skip: ${skip}, take: ${take})`);\r\n\r\n    return this.resourcesService.findAll({\r\n      skip,\r\n      take,\r\n      type,\r\n      category,\r\n      search,\r\n      sortBy,\r\n      sortOrder,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * 搜索建议（实时）\r\n   * GET /api/v1/resources/search/suggestions?q=AI&limit=5\r\n   *\r\n   * 注意：此路由必须在 @Get(':id') 之前，否则会被 :id 捕获\r\n   */\r\n  @Get('search/suggestions')\r\n  async searchSuggestions(\r\n    @Query('q') query: string,\r\n    @Query('limit', new DefaultValuePipe(5), ParseIntPipe) limit: number,\r\n  ) {\r\n    if (!query || query.trim().length < 2) {\r\n      return { suggestions: [] };\r\n    }\r\n\r\n    this.logger.log(`Searching suggestions for: ${query}`);\r\n\r\n    const suggestions = await this.resourcesService.searchSuggestions(query, limit);\r\n\r\n    return { suggestions };\r\n  }\r\n\r\n  /**\r\n   * 获取资源统计\r\n   * GET /api/v1/resources/stats/summary\r\n   *\r\n   * 注意：此路由必须在 @Get(':id') 之前，否则会被 :id 捕获\r\n   */\r\n  @Get('stats/summary')\r\n  async getStats() {\r\n    this.logger.log('Fetching resource statistics');\r\n\r\n    return this.resourcesService.getStats();\r\n  }\r\n\r\n  /**\r\n   * 检查 AI 服务健康状态\r\n   * GET /api/v1/resources/ai/health\r\n   *\r\n   * 注意：此路由必须在 @Get(':id') 之前，否则会被 :id 捕获\r\n   */\r\n  @Get('ai/health')\r\n  async checkAIHealth() {\r\n    this.logger.log('Checking AI service health');\r\n\r\n    const isHealthy = await this.aiEnrichmentService.checkHealth();\r\n\r\n    return {\r\n      status: isHealthy ? 'ok' : 'error',\r\n      aiServiceAvailable: isHealthy,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 获取资源详情\r\n   * GET /api/v1/resources/:id\r\n   *\r\n   * 注意：动态路由必须放在所有具体路由之后，以免捕获其他路径\r\n   */\r\n  @Get(':id')\r\n  async findOne(@Param('id') id: string) {\r\n    this.logger.log(`Fetching resource ${id}`);\r\n\r\n    return this.resourcesService.findOne(id);\r\n  }\r\n\r\n  /**\r\n   * 创建资源\r\n   * POST /api/v1/resources\r\n   */\r\n  @Post()\r\n  async create(@Body() createResourceDto: Prisma.ResourceCreateInput) {\r\n    this.logger.log('Creating new resource');\r\n\r\n    return this.resourcesService.create(createResourceDto);\r\n  }\r\n\r\n  /**\r\n   * 更新资源\r\n   * PATCH /api/v1/resources/:id\r\n   */\r\n  @Patch(':id')\r\n  async update(\r\n    @Param('id') id: string,\r\n    @Body() updateResourceDto: Prisma.ResourceUpdateInput,\r\n  ) {\r\n    this.logger.log(`Updating resource ${id}`);\r\n\r\n    return this.resourcesService.update(id, updateResourceDto);\r\n  }\r\n\r\n  /**\r\n   * 删除资源\r\n   * DELETE /api/v1/resources/:id\r\n   */\r\n  @Delete(':id')\r\n  async remove(@Param('id') id: string) {\r\n    this.logger.log(`Deleting resource ${id}`);\r\n\r\n    return this.resourcesService.remove(id);\r\n  }\r\n\r\n  /**\r\n   * AI 增强资源（生成摘要、洞察、分类）\r\n   * POST /api/v1/resources/:id/enrich\r\n   */\r\n  @Post(':id/enrich')\r\n  async enrichResource(@Param('id') id: string) {\r\n    this.logger.log(`Enriching resource ${id} with AI`);\r\n\r\n    // 获取资源\r\n    const resource = await this.resourcesService.findOne(id);\r\n    if (!resource) {\r\n      throw new HttpException(`Resource ${id} not found`, HttpStatus.NOT_FOUND);\r\n    }\r\n\r\n    // 调用 AI 增强服务\r\n    const enrichment = await this.aiEnrichmentService.enrichResource({\r\n      title: resource.title,\r\n      abstract: resource.abstract ?? undefined,\r\n      content: resource.content ?? undefined,\r\n      sourceUrl: resource.sourceUrl,\r\n    });\r\n\r\n    // 更新资源\r\n    const updated = await this.resourcesService.update(id, {\r\n      aiSummary: enrichment.aiSummary,\r\n      keyInsights: enrichment.keyInsights as any,\r\n      primaryCategory: enrichment.primaryCategory,\r\n      autoTags: enrichment.autoTags,\r\n      difficultyLevel: enrichment.difficultyLevel,\r\n    });\r\n\r\n    this.logger.log(`Resource ${id} enriched successfully`);\r\n\r\n    return updated;\r\n  }\r\n\r\n  /**\r\n   * 上传并保存资源缩略图\r\n   * POST /api/v1/resources/:id/thumbnail\r\n   *\r\n   * 前端使用 PDF.js 客户端生成缩略图，然后上传到服务器\r\n   */\r\n  @Post(':id/thumbnail')\r\n  @UseInterceptors(\r\n    FileInterceptor('thumbnail', {\r\n      storage: diskStorage({\r\n        destination: async (_req, _file, cb) => {\r\n          const uploadPath = path.join(process.cwd(), 'public', 'thumbnails');\r\n          try {\r\n            await fs.mkdir(uploadPath, { recursive: true });\r\n            cb(null, uploadPath);\r\n          } catch (error) {\r\n            cb(error as Error, uploadPath);\r\n          }\r\n        },\r\n        filename: (req, file, cb) => {\r\n          const resourceId = req.params.id;\r\n          const ext = path.extname(file.originalname) || '.jpg';\r\n          cb(null, `${resourceId}${ext}`);\r\n        },\r\n      }),\r\n      limits: {\r\n        fileSize: 5 * 1024 * 1024, // 5MB max\r\n      },\r\n      fileFilter: (_req, file, cb) => {\r\n        // 只接受图片文件\r\n        if (file.mimetype.startsWith('image/')) {\r\n          cb(null, true);\r\n        } else {\r\n          cb(new Error('Only image files are allowed'), false);\r\n        }\r\n      },\r\n    })\r\n  )\r\n  async uploadThumbnail(\r\n    @Param('id') id: string,\r\n    @UploadedFile() file: Express.Multer.File\r\n  ) {\r\n    this.logger.log(`Uploading thumbnail for resource ${id}`);\r\n\r\n    if (!file) {\r\n      throw new HttpException('No file uploaded', HttpStatus.BAD_REQUEST);\r\n    }\r\n\r\n    // 检查资源是否存在\r\n    const resource = await this.resourcesService.findOne(id);\r\n    if (!resource) {\r\n      throw new HttpException(`Resource ${id} not found`, HttpStatus.NOT_FOUND);\r\n    }\r\n\r\n    // 构建缩略图 URL\r\n    const thumbnailUrl = `/thumbnails/${file.filename}`;\r\n\r\n    // 更新资源的缩略图 URL\r\n    const updated = await this.resourcesService.update(id, {\r\n      thumbnailUrl,\r\n    });\r\n\r\n    this.logger.log(`Thumbnail uploaded successfully for resource ${id}`);\r\n\r\n    return {\r\n      message: 'Thumbnail uploaded successfully',\r\n      thumbnailUrl,\r\n      resource: updated,\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\resources\\resources.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\resources\\resources.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":45,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":45,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1100,1103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1100,1103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":50,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":53,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1327,1330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1327,1330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":104,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":104,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":111,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":111,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .data on an `any` value.","line":111,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":111,"endColumn":29},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":287,"column":24,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":287,"endColumn":26,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[6822,6839],"text":"(title ?? abstract)"},"desc":"Fix to nullish coalescing operator (`??`)."}]},{"ruleId":"@typescript-eslint/prefer-nullish-coalescing","severity":1,"message":"Prefer using nullish coalescing operator (`??`) instead of a logical or (`||`), as it is a safer operator.","line":287,"column":36,"nodeType":"Punctuator","messageId":"preferNullishOverOr","endLine":287,"endColumn":38,"suggestions":[{"messageId":"suggestNullish","fix":{"range":[6840,6842],"text":"??"},"desc":"Fix to nullish coalescing operator (`??`)."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, Logger, NotFoundException } from '@nestjs/common';\r\nimport { PrismaService } from '../common/prisma/prisma.service';\r\nimport { MongoDBService } from '../common/mongodb/mongodb.service';\r\nimport { ensureError } from '../common/utils/error.utils';\r\nimport { Prisma } from '@prisma/client';\r\n\r\n/**\r\n * 资源管理服务\r\n */\r\n@Injectable()\r\nexport class ResourcesService {\r\n  private readonly logger = new Logger(ResourcesService.name);\r\n\r\n  constructor(\r\n    private prisma: PrismaService,\r\n    private mongodb: MongoDBService,\r\n  ) {}\r\n\r\n  /**\r\n   * 获取资源列表（分页+过滤）\r\n   */\r\n  async findAll(params: {\r\n    skip?: number;\r\n    take?: number;\r\n    type?: string;\r\n    category?: string;\r\n    search?: string;\r\n    sortBy?: 'publishedAt' | 'qualityScore' | 'trendingScore';\r\n    sortOrder?: 'asc' | 'desc';\r\n  }) {\r\n    const {\r\n      skip = 0,\r\n      take = 20,\r\n      type,\r\n      category,\r\n      search,\r\n      sortBy = 'publishedAt',\r\n      sortOrder = 'desc',\r\n    } = params;\r\n\r\n    // 构建查询条件\r\n    const where: Prisma.ResourceWhereInput = {};\r\n\r\n    if (type) {\r\n      where.type = type as any;\r\n    }\r\n\r\n    if (category) {\r\n      // For JSON array fields in Prisma, we need to use path and array_contains with an array\r\n      where.categories = {\r\n        path: [],\r\n        array_contains: [category],\r\n      } as any;\r\n    }\r\n\r\n    if (search) {\r\n      where.OR = [\r\n        { title: { contains: search, mode: 'insensitive' } },\r\n        { abstract: { contains: search, mode: 'insensitive' } },\r\n      ];\r\n    }\r\n\r\n    // 执行查询\r\n    const [resources, total] = await Promise.all([\r\n      this.prisma.resource.findMany({\r\n        where,\r\n        skip,\r\n        take,\r\n        orderBy: {\r\n          [sortBy]: sortOrder,\r\n        },\r\n      }),\r\n      this.prisma.resource.count({ where }),\r\n    ]);\r\n\r\n    this.logger.log(`Found ${resources.length}/${total} resources (skip: ${skip}, take: ${take})`);\r\n\r\n    return {\r\n      data: resources,\r\n      pagination: {\r\n        total,\r\n        skip,\r\n        take,\r\n        hasMore: skip + take < total,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 获取单个资源详情\r\n   */\r\n  async findOne(id: string) {\r\n    const resource = await this.prisma.resource.findUnique({\r\n      where: { id },\r\n    });\r\n\r\n    if (!resource) {\r\n      throw new NotFoundException(`Resource with ID ${id} not found`);\r\n    }\r\n\r\n    // 如果有 rawDataId，获取完整原始数据\r\n    let rawData = null;\r\n    if (resource.rawDataId) {\r\n      rawData = await this.mongodb.findRawDataById(resource.rawDataId);\r\n    }\r\n\r\n    this.logger.log(`Retrieved resource ${id}`);\r\n\r\n    return {\r\n      ...resource,\r\n      rawData: rawData?.data || null,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 创建资源\r\n   */\r\n  async create(data: Prisma.ResourceCreateInput) {\r\n    const resource = await this.prisma.resource.create({\r\n      data,\r\n    });\r\n\r\n    this.logger.log(`Created resource ${resource.id}`);\r\n\r\n    return resource;\r\n  }\r\n\r\n  /**\r\n   * 更新资源\r\n   */\r\n  async update(id: string, data: Prisma.ResourceUpdateInput) {\r\n    try {\r\n      const resource = await this.prisma.resource.update({\r\n        where: { id },\r\n        data,\r\n      });\r\n\r\n      this.logger.log(`Updated resource ${id}`);\r\n\r\n      return resource;\r\n    } catch (error) {\r\n      const err = error as { code?: string };\r\n      if (err.code === 'P2025') {\r\n        throw new NotFoundException(`Resource with ID ${id} not found`);\r\n      }\r\n      throw ensureError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 删除资源\r\n   */\r\n  async remove(id: string) {\r\n    try {\r\n      const resource = await this.prisma.resource.delete({\r\n        where: { id },\r\n      });\r\n\r\n      this.logger.log(`Deleted resource ${id}`);\r\n\r\n      return resource;\r\n    } catch (error) {\r\n      const err = error as { code?: string };\r\n      if (err.code === 'P2025') {\r\n        throw new NotFoundException(`Resource with ID ${id} not found`);\r\n      }\r\n      throw ensureError(error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 按类型统计资源数量\r\n   */\r\n  async getStats() {\r\n    const stats = await this.prisma.resource.groupBy({\r\n      by: ['type'],\r\n      _count: {\r\n        id: true,\r\n      },\r\n    });\r\n\r\n    const totalCount = await this.prisma.resource.count();\r\n\r\n    return {\r\n      total: totalCount,\r\n      byType: stats.map((s) => ({\r\n        type: s.type,\r\n        count: s._count.id,\r\n      })),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * 搜索建议（实时）\r\n   * 混合搜索：全文搜索 + 相关性排序\r\n   */\r\n  async searchSuggestions(query: string, limit: number = 5) {\r\n    const searchQuery = query.trim().toLowerCase();\r\n\r\n    // 执行全文搜索\r\n    const results = await this.prisma.resource.findMany({\r\n      where: {\r\n        OR: [\r\n          { title: { contains: searchQuery, mode: 'insensitive' } },\r\n          { abstract: { contains: searchQuery, mode: 'insensitive' } },\r\n          { content: { contains: searchQuery, mode: 'insensitive' } },\r\n        ],\r\n      },\r\n      select: {\r\n        id: true,\r\n        type: true,\r\n        title: true,\r\n        abstract: true,\r\n        publishedAt: true,\r\n        qualityScore: true,\r\n      },\r\n      take: limit * 2, // 获取更多结果用于排序\r\n      orderBy: {\r\n        qualityScore: 'desc', // 按质量分数排序\r\n      },\r\n    });\r\n\r\n    // 计算相关性分数并排序\r\n    const scoredResults = results.map((resource) => {\r\n      let score = 0;\r\n\r\n      // 标题匹配权重更高\r\n      if (resource.title?.toLowerCase().includes(searchQuery)) {\r\n        score += 10;\r\n        // 精确匹配额外加分\r\n        if (resource.title?.toLowerCase() === searchQuery) {\r\n          score += 20;\r\n        }\r\n        // 开头匹配加分\r\n        if (resource.title?.toLowerCase().startsWith(searchQuery)) {\r\n          score += 5;\r\n        }\r\n      }\r\n\r\n      // 摘要匹配\r\n      if (resource.abstract?.toLowerCase().includes(searchQuery)) {\r\n        score += 5;\r\n      }\r\n\r\n      // 质量分数加权\r\n      score += (Number(resource.qualityScore) || 0) * 0.1;\r\n\r\n      // 新鲜度加权（最近发布的加分）\r\n      if (resource.publishedAt) {\r\n        const daysSincePublished = Math.floor(\r\n          (Date.now() - new Date(resource.publishedAt).getTime()) / (1000 * 60 * 60 * 24),\r\n        );\r\n        if (daysSincePublished < 7) score += 3;\r\n        else if (daysSincePublished < 30) score += 2;\r\n        else if (daysSincePublished < 90) score += 1;\r\n      }\r\n\r\n      return {\r\n        ...resource,\r\n        searchScore: score,\r\n        highlight: this.generateHighlight(resource.title, resource.abstract, searchQuery),\r\n      };\r\n    });\r\n\r\n    // 按分数排序并返回前N个\r\n    const topResults = scoredResults\r\n      .sort((a, b) => b.searchScore - a.searchScore)\r\n      .slice(0, limit);\r\n\r\n    return topResults.map((r) => ({\r\n      id: r.id,\r\n      title: r.title,\r\n      type: r.type,\r\n      abstract: r.abstract?.substring(0, 150) + '...',\r\n      highlight: r.highlight,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * 生成搜索高亮片段\r\n   */\r\n  private generateHighlight(\r\n    title: string | null,\r\n    abstract: string | null,\r\n    query: string,\r\n  ): string {\r\n    const text = title || abstract || '';\r\n    const lowerText = text.toLowerCase();\r\n    const lowerQuery = query.toLowerCase();\r\n\r\n    const index = lowerText.indexOf(lowerQuery);\r\n    if (index === -1) return text.substring(0, 100) + '...';\r\n\r\n    // 获取匹配周围的文本\r\n    const start = Math.max(0, index - 30);\r\n    const end = Math.min(text.length, index + query.length + 30);\r\n\r\n    let snippet = text.substring(start, end);\r\n    if (start > 0) snippet = '...' + snippet;\r\n    if (end < text.length) snippet = snippet + '...';\r\n\r\n    return snippet;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\scripts\\fix-arxiv-urls.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":11,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":11,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[244,282],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":24,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":24,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[584,633],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1122,1174],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":48,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":48,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1319,1384],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":56,"column":1,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":56,"endColumn":16,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[1505,1505],"text":"void "},"desc":"Add void operator to ignore."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PrismaClient } from '@prisma/client';\r\nimport { getErrorMessage } from '../common/utils/error.utils';\r\n\r\n/**\r\n * 脚本：将现有arXiv论文的HTTP URL改为HTTPS\r\n */\r\nasync function fixArxivUrls() {\r\n  const prisma = new PrismaClient();\r\n\r\n  try {\r\n    console.log('🔧 开始修复 arXiv URL...\\n');\r\n\r\n    // 查找所有 HTTP arxiv URL 的 PAPER\r\n    const papers = await prisma.resource.findMany({\r\n      where: {\r\n        type: 'PAPER',\r\n        OR: [\r\n          { sourceUrl: { contains: 'http://arxiv.org' } },\r\n          { pdfUrl: { contains: 'http://arxiv.org' } },\r\n        ],\r\n      },\r\n    });\r\n\r\n    console.log(`📊 找到 ${papers.length} 篇需要修复的论文\\n`);\r\n\r\n    let successCount = 0;\r\n\r\n    for (const paper of papers) {\r\n      try {\r\n        const updatedSourceUrl = paper.sourceUrl?.replace('http://arxiv.org', 'https://arxiv.org');\r\n        const updatedPdfUrl = paper.pdfUrl?.replace('http://arxiv.org', 'https://arxiv.org');\r\n\r\n        await prisma.resource.update({\r\n          where: { id: paper.id },\r\n          data: {\r\n            sourceUrl: updatedSourceUrl,\r\n            pdfUrl: updatedPdfUrl,\r\n          },\r\n        });\r\n\r\n        console.log(`✅ ${paper.title.substring(0, 60)}...`);\r\n        successCount++;\r\n      } catch (error) {\r\n        console.error(`❌ 修复失败 ${paper.id}:`, getErrorMessage(error));\r\n      }\r\n    }\r\n\r\n    console.log(`\\n✅ 修复完成！共修复 ${successCount}/${papers.length} 篇论文`);\r\n  } catch (error) {\r\n    console.error('❌ 脚本执行失败:', error);\r\n  } finally {\r\n    await prisma.$disconnect();\r\n  }\r\n}\r\n\r\nfixArxivUrls();\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\scripts\\fix-github-titles.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":20,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":20,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[616,658],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":34,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":34,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[922,980],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":46,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":46,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1234,1284],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":54,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":54,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe construction of an any type value.","line":54,"column":16,"nodeType":"NewExpression","messageId":"unsafeNew","endLine":54,"endColumn":69},{"ruleId":"@typescript-eslint/no-var-requires","severity":2,"message":"Require statement not part of import statement.","line":54,"column":21,"nodeType":"CallExpression","messageId":"noVarReqs","endLine":54,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .ObjectId on an `any` value.","line":54,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":54,"endColumn":48},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1561,1612],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":64,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":64,"endColumn":95},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .fullName on an `any` value.","line":64,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":64,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .name on an `any` value.","line":64,"column":63,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":64,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .externalId on an `any` value.","line":64,"column":85,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":64,"endColumn":95},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":67,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":67,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1845,1906],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":75,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":75,"endColumn":31},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":78,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":78,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2125,2151],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":79,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2161,2206],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":87,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":87,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2376,2401],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":88,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":88,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2407,2445],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":89,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":89,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2451,2486],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":98,"column":1,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":98,"endColumn":19,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[2639,2639],"text":"void "},"desc":"Add void operator to ignore."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PrismaClient } from '@prisma/client';\r\nimport { MongoClient } from 'mongodb';\r\nimport { getErrorMessage } from '../common/utils/error.utils';\r\n\r\n/**\r\n * 脚本：修复GitHub资源缺失的title\r\n *\r\n * 问题：30条GitHub资源没有title\r\n * 方案：从raw_data中提取fullName或name作为title\r\n */\r\nasync function fixGitHubTitles() {\r\n  const prisma = new PrismaClient();\r\n  const mongoClient = new MongoClient('mongodb://deepdive:mongo_dev_password@localhost:27017/deepdive?authSource=admin');\r\n\r\n  try {\r\n    await mongoClient.connect();\r\n    const db = mongoClient.db();\r\n    const rawDataCollection = db.collection('data_collection_raw_data');\r\n\r\n    console.log('🔧 开始修复GitHub资源的title...\\n');\r\n\r\n    // 获取所有type=PROJECT的资源（我们会检查哪些没有title）\r\n    const resources = await prisma.resource.findMany({\r\n      where: {\r\n        type: 'PROJECT'\r\n      },\r\n      select: {\r\n        id: true,\r\n        title: true,\r\n        rawDataId: true,\r\n      },\r\n    });\r\n\r\n    console.log(`📊 找到 ${resources.length} 个需要修复的GitHub资源\\n`);\r\n\r\n    let successCount = 0;\r\n    let failCount = 0;\r\n\r\n    for (const resource of resources) {\r\n      // 跳过已有title的资源\r\n      if (resource.title && resource.title.trim() !== '') {\r\n        continue;\r\n      }\r\n\r\n      if (!resource.rawDataId) {\r\n        console.log(`❌ 资源 ${resource.id} 没有rawDataId，跳过`);\r\n        failCount++;\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        // 从MongoDB获取raw_data\r\n        const rawData = await rawDataCollection.findOne({\r\n          _id: new (require('mongodb').ObjectId)(resource.rawDataId)\r\n        });\r\n\r\n        if (!rawData) {\r\n          console.log(`❌ 未找到rawData: ${resource.rawDataId}`);\r\n          failCount++;\r\n          continue;\r\n        }\r\n\r\n        // 提取title（优先使用fullName，其次name）\r\n        const title = rawData.data?.fullName || rawData.data?.name || rawData.data?.externalId;\r\n\r\n        if (!title) {\r\n          console.log(`❌ rawData中没有可用的title数据: ${resource.rawDataId}`);\r\n          failCount++;\r\n          continue;\r\n        }\r\n\r\n        // 更新resource\r\n        await prisma.resource.update({\r\n          where: { id: resource.id },\r\n          data: { title: title }\r\n        });\r\n\r\n        console.log(`✅ ${title}`);\r\n        console.log(`   resourceId: ${resource.id}`);\r\n        successCount++;\r\n      } catch (error) {\r\n        console.error(`❌ 修复失败 ${resource.id}:`, getErrorMessage(error));\r\n        failCount++;\r\n      }\r\n    }\r\n\r\n    console.log(`\\n✅ 修复完成！`);\r\n    console.log(`   成功: ${successCount}`);\r\n    console.log(`   失败: ${failCount}`);\r\n  } catch (error) {\r\n    console.error('❌ 脚本执行失败:', error);\r\n  } finally {\r\n    await prisma.$disconnect();\r\n    await mongoClient.close();\r\n  }\r\n}\r\n\r\nfixGitHubTitles();\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\scripts\\generate-thumbnails.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":12,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":12,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[302,398],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":13,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":13,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[404,433],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":14,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":14,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[439,537],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":32,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":32,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[863,911],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":35,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":35,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[953,983],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":41,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":41,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1107,1173],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":44,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":44,"endColumn":18,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1232,1260],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1502,1600],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":57,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":57,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1606,1630],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":58,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":58,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1636,1676],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":59,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":59,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1682,1721],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":60,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":60,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1727,1768],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":61,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":61,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1774,1872],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":64,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":64,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1908,1953],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":77,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":77,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2318,2350],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":78,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":78,"endColumn":20,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2360,2408],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":83,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2456,2508],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":84,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":84,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2514,2610],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":92,"column":1,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":92,"endColumn":22,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[2731,2731],"text":"void "},"desc":"Add void operator to ignore."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PrismaClient } from '@prisma/client';\r\nimport { PdfThumbnailService } from '../resources/pdf-thumbnail.service';\r\n\r\n/**\r\n * 批量生成PDF缩略图脚本\r\n */\r\nasync function generateThumbnails() {\r\n  const prisma = new PrismaClient();\r\n  const pdfThumbnailService = new PdfThumbnailService();\r\n\r\n  try {\r\n    console.log('================================================================================');\r\n    console.log('📸 批量生成PDF缩略图');\r\n    console.log('================================================================================\\n');\r\n\r\n    // 获取所有PAPER类型且有pdfUrl的资源\r\n    const papers = await prisma.resource.findMany({\r\n      where: {\r\n        type: 'PAPER',\r\n        pdfUrl: {\r\n          not: null,\r\n        },\r\n      },\r\n      select: {\r\n        id: true,\r\n        title: true,\r\n        pdfUrl: true,\r\n        thumbnailUrl: true,\r\n      },\r\n    });\r\n\r\n    console.log(`📊 找到 ${papers.length} 篇论文需要处理\\n`);\r\n\r\n    if (papers.length === 0) {\r\n      console.log('✅ 没有需要生成缩略图的论文');\r\n      return;\r\n    }\r\n\r\n    // 过滤掉已有缩略图的\r\n    const papersNeedingThumbnails = papers.filter((p) => !p.thumbnailUrl);\r\n    console.log(`🔄 其中 ${papersNeedingThumbnails.length} 篇需要生成缩略图\\n`);\r\n\r\n    if (papersNeedingThumbnails.length === 0) {\r\n      console.log('✅ 所有论文都已有缩略图');\r\n      return;\r\n    }\r\n\r\n    // 批量生成\r\n    const resources = papersNeedingThumbnails.map((p) => ({\r\n      id: p.id,\r\n      pdfUrl: p.pdfUrl!,\r\n    }));\r\n\r\n    const stats = await pdfThumbnailService.generateBatchThumbnails(resources);\r\n\r\n    console.log('\\n================================================================================');\r\n    console.log('📊 生成统计:');\r\n    console.log(`  ✅ 成功: ${stats.success}`);\r\n    console.log(`  ❌ 失败: ${stats.failed}`);\r\n    console.log(`  ⏭️ 跳过: ${stats.skipped}`);\r\n    console.log('================================================================================\\n');\r\n\r\n    // 更新数据库中的thumbnailUrl\r\n    console.log('📝 更新数据库中的thumbnailUrl字段...\\n');\r\n\r\n    let updateCount = 0;\r\n    for (const paper of papersNeedingThumbnails) {\r\n      const thumbnailUrl = `/thumbnails/${paper.id}.jpg`;\r\n\r\n      // 检查缩略图是否真的存在\r\n      if (await pdfThumbnailService.thumbnailExists(paper.id)) {\r\n        await prisma.resource.update({\r\n          where: { id: paper.id },\r\n          data: { thumbnailUrl },\r\n        });\r\n\r\n        console.log(`✅ ${paper.title}`);\r\n        console.log(`   thumbnailUrl: ${thumbnailUrl}`);\r\n        updateCount++;\r\n      }\r\n    }\r\n\r\n    console.log(`\\n✅ 数据库更新完成！共更新 ${updateCount} 条记录\\n`);\r\n    console.log('================================================================================');\r\n  } catch (error) {\r\n    console.error('❌ 批量生成失败:', error);\r\n  } finally {\r\n    await prisma.$disconnect();\r\n  }\r\n}\r\n\r\ngenerateThumbnails();\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\projects\\deepdive-engine\\backend\\src\\scripts\\link-raw-data.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":21,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":21,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[647,696],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[983,1043],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":1,"message":"Unsafe assignment of an `any` value.","line":45,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":45,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":1,"message":"Unsafe construction of an any type value.","line":45,"column":18,"nodeType":"NewExpression","messageId":"unsafeNew","endLine":45,"endColumn":71},{"ruleId":"@typescript-eslint/no-var-requires","severity":2,"message":"Require statement not part of import statement.","line":45,"column":23,"nodeType":"CallExpression","messageId":"noVarReqs","endLine":45,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":1,"message":"Unsafe member access .ObjectId on an `any` value.","line":45,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":45,"endColumn":50},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":55,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":55,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1494,1549],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1561,1641],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":59,"column":11,"nodeType":"MemberExpression","messageId":"unexpected","endLine":59,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1698,1750],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":68,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":68,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1930,1955],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":69,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":69,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[1961,1999],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":70,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":70,"endColumn":16,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"log"},"fix":{"range":[2005,2040],"text":""},"desc":"Remove the console.log()."}]},{"ruleId":"@typescript-eslint/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":79,"column":1,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":79,"endColumn":26,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[2193,2193],"text":"void "},"desc":"Add void operator to ignore."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PrismaClient } from '@prisma/client';\r\nimport { MongoClient } from 'mongodb';\r\nimport { getErrorMessage } from '../common/utils/error.utils';\r\n\r\n/**\r\n * 脚本：为现有的 MongoDB raw_data 添加 resourceId 反向引用\r\n *\r\n * 解决问题：\r\n * - MongoDB raw_data 集合缺少 resource ID 引用\r\n * - 建立双向引用关系\r\n */\r\nasync function linkRawDataToResources() {\r\n  const prisma = new PrismaClient();\r\n  const mongoClient = new MongoClient('mongodb://deepdive:mongo_dev_password@localhost:27017/deepdive?authSource=admin');\r\n\r\n  try {\r\n    await mongoClient.connect();\r\n    const db = mongoClient.db();\r\n    const rawDataCollection = db.collection('data_collection_raw_data');\r\n\r\n    console.log('🔗 开始链接 raw_data 到 resources...\\n');\r\n\r\n    // 获取所有有 rawDataId 的 resources\r\n    const resources = await prisma.resource.findMany({\r\n      where: {\r\n        rawDataId: {\r\n          not: null,\r\n        },\r\n      },\r\n      select: {\r\n        id: true,\r\n        rawDataId: true,\r\n        title: true,\r\n      },\r\n    });\r\n\r\n    console.log(`📊 找到 ${resources.length} 个需要链接的 resources\\n`);\r\n\r\n    let successCount = 0;\r\n    let failCount = 0;\r\n\r\n    for (const resource of resources) {\r\n      try {\r\n        const result = await rawDataCollection.updateOne(\r\n          { _id: new (require('mongodb').ObjectId)(resource.rawDataId) },\r\n          {\r\n            $set: {\r\n              resourceId: resource.id,\r\n              updatedAt: new Date(),\r\n            },\r\n          },\r\n        );\r\n\r\n        if (result.matchedCount > 0) {\r\n          console.log(`✅ ${resource.title.substring(0, 60)}...`);\r\n          console.log(`   rawDataId: ${resource.rawDataId} → resourceId: ${resource.id}`);\r\n          successCount++;\r\n        } else {\r\n          console.log(`❌ 未找到 rawData: ${resource.rawDataId}`);\r\n          failCount++;\r\n        }\r\n      } catch (error) {\r\n        console.error(`❌ 链接失败 ${resource.id}:`, getErrorMessage(error));\r\n        failCount++;\r\n      }\r\n    }\r\n\r\n    console.log(`\\n✅ 链接完成！`);\r\n    console.log(`   成功: ${successCount}`);\r\n    console.log(`   失败: ${failCount}`);\r\n  } catch (error) {\r\n    console.error('❌ 脚本执行失败:', error);\r\n  } finally {\r\n    await prisma.$disconnect();\r\n    await mongoClient.close();\r\n  }\r\n}\r\n\r\nlinkRawDataToResources();\r\n","usedDeprecatedRules":[]}]
