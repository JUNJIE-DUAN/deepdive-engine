# 数据采集系统文档中心

欢迎来到DeepDive数据采集系统的完整文档中心。本目录包含了数据采集系统重构项目的所有设计文档。

---

## 📚 文档导航

### 核心文档

| 文档                                                       | 描述                               | 状态    |
| ---------------------------------------------------------- | ---------------------------------- | ------- |
| [产品需求文档 v3.0](../prd/data-collection-system-v3.0.md) | 完整的产品需求、功能设计和业务目标 | ✅ 完成 |
| [技术架构文档](./architecture.md)                          | 系统架构、技术栈和核心模块设计     | ✅ 完成 |
| [数据模型设计](./data-model.md)                            | 数据库Schema、数据流和存储策略     | ✅ 完成 |
| [实施路线图](./implementation-roadmap.md)                  | 9周开发计划、任务清单和验收标准    | ✅ 完成 |

---

## 🎯 快速开始

### 对于产品经理

1. 先阅读 [产品需求文档](../prd/data-collection-system-v3.0.md)
2. 了解业务目标和功能设计
3. 查看UI设计和用户流程

### 对于技术负责人

1. 先阅读 [技术架构文档](./architecture.md)
2. 了解技术选型和系统设计
3. 查看 [数据模型设计](./data-model.md)

### 对于开发人员

1. 先阅读 [实施路线图](./implementation-roadmap.md)
2. 查看对应Phase的任务清单
3. 参考 [技术架构文档](./architecture.md) 中的代码示例

### 对于测试人员

1. 阅读 [产品需求文档](../prd/data-collection-system-v3.0.md) 了解功能
2. 查看 [实施路线图](./implementation-roadmap.md) 的验收标准
3. 参考各Phase的测试要求

---

## 📖 文档详细说明

### 1. 产品需求文档 v3.0

**路径**: `docs/prd/data-collection-system-v3.0.md`

**内容概览**:

- 产品定位和目标
- 现状问题分析（4个致命问题）
- 完整功能设计（6个核心页面）
- 数据质量保障体系
- 去重策略详解
- 开发计划（9周）

**适合阅读人群**: 产品经理、项目经理、业务人员

---

### 2. 技术架构文档

**路径**: `docs/data-management/architecture.md`

**内容概览**:

- 系统整体架构图
- 技术栈详解（前端、后端、AI服务）
- 核心模块设计
  - 任务调度模块（BullMQ）
  - 数据采集模块（爬虫基类和具体实现）
  - 去重引擎模块（4层去重机制）
  - 数据质量模块（评分算法）
  - AI增强模块（Grok/OpenAI集成）
- 完整数据采集流程（10步骤）
- 性能优化策略
- 监控和告警设计
- 安全设计
- 部署架构

**适合阅读人群**: 架构师、技术负责人、高级开发工程师

---

### 3. 数据模型设计

**路径**: `docs/data-management/data-model.md`

**内容概览**:

- 多数据库架构（PostgreSQL、MongoDB、Neo4j、Redis、Qdrant）
- PostgreSQL完整Schema设计
  - Resource表（资源主表）
  - CollectionTask表（采集任务）
  - DataSource表（数据源配置）
  - DeduplicationRecord表（去重记录）
  - DataQualityMetric表（质量指标）
- MongoDB原始数据集合设计
  - 完整字段定义
  - 索引设计
- Redis数据结构设计
- Neo4j知识图谱设计
- Qdrant向量数据设计
- 数据一致性保证机制
- 数据迁移策略

**适合阅读人群**: 后端开发工程师、DBA、数据工程师

---

### 4. 实施路线图

**路径**: `docs/data-management/implementation-roadmap.md`

**内容概览**:

- 项目总览和里程碑
- **Phase 1**: 基础架构优化（Week 1-2）
  - Week 1: 数据模型重构
  - Week 2: 去重引擎开发
- **Phase 2**: 数据源扩展（Week 3-4）
  - Week 3: 新增5个爬虫
  - Week 4: 爬虫优化和测试
- **Phase 3**: 任务调度系统（Week 5）
  - BullMQ集成
  - Cron定时调度
  - 任务监控
- **Phase 4**: 数据质量保障（Week 6）
  - 质量评分算法
  - 问题检测和自动修复
- **Phase 5**: UI开发（Week 7-8）
  - Week 7: 核心页面
  - Week 8: 监控和质量页面
- **Phase 6**: 测试和上线（Week 9）
  - 单元测试、集成测试、性能测试
  - 部署上线
- 详细的任务清单和验收标准
- 风险管理
- 资源分配
- 成功指标

**适合阅读人群**: 项目经理、开发团队、测试团队

---

## 🔧 关键设计决策

### Settings vs Collection 架构决策

**决策**: 保留Settings，新建独立的data-collection页面

**理由**:

- Settings应该是系统级配置，偏向"设置后不常改动"
- Data Collection是日常运营工作台，需要频繁监控和操作
- 功能分离更清晰，避免Settings页面过于臃肿

**实施方案**:

```
/admin/settings          → 系统配置（保留，简化）
  ├─ Whitelist Tab      → 域名白名单
  ├─ Quality Tab        → 数据质量阈值
  └─ System Tab         → 其他系统配置

/data-collection         → 数据采集中心（新建）
  ├─ Dashboard          → 采集总览
  ├─ Sources            → 数据源管理
  ├─ Scheduler          → 采集计划
  ├─ Monitor            → 实时监控
  ├─ Quality            → 质量管理
  └─ History            → 采集历史
```

### 双存储架构决策

**决策**: PostgreSQL + MongoDB 双存储

**理由**:

- **PostgreSQL**: 结构化业务数据，支持ACID事务和复杂查询
- **MongoDB**: 完整原始数据，灵活Schema适合不规则数据
- **双向引用**: 确保数据可追溯和重新处理

**关键实现**:

```typescript
// PostgreSQL Resource
{
  id: "uuid",
  title: "...",
  rawDataId: "mongodb-objectid"  // ⭐ 关联MongoDB
}

// MongoDB RawData
{
  _id: ObjectId,
  data: { ... },  // 100%原始数据
  resourceId: "uuid"  // ⭐ 关联PostgreSQL
}
```

### 去重策略决策

**决策**: 4层渐进式去重

**理由**:

- URL哈希去重最快（O(1)），优先使用
- 标题相似度处理URL变化的情况
- 内容指纹处理文章改标题的情况
- 作者+时间处理学术论文的特殊情况

**性能目标**: <100ms/条

---

## 🚀 下一步行动

### 立即行动（P0 - 本周）

1. ✅ **审阅文档**: 所有相关方审阅上述4个文档
2. ⬜ **召开启动会**: 确定项目团队和时间表
3. ⬜ **环境准备**: 搭建开发环境、创建代码仓库分支

### 短期计划（P1 - Week 1-2）

4. ⬜ **数据模型重构**: 按照data-model.md更新Prisma Schema
5. ⬜ **去重引擎开发**: 实现4层去重机制
6. ⬜ **数据迁移**: 迁移现有数据到新Schema

### 中期计划（P2 - Week 3-6）

7. ⬜ **数据源扩展**: 新增5个爬虫
8. ⬜ **任务调度**: BullMQ集成
9. ⬜ **质量保障**: 质量评分和问题检测

### 长期计划（P3 - Week 7-9）

10. ⬜ **UI开发**: 6个核心页面
11. ⬜ **测试**: 单元测试、集成测试、性能测试
12. ⬜ **上线**: 部署到生产环境

---

## ❓ 常见问题

### Q1: 为什么要彻底重构数据采集系统？

**A**: 当前系统存在4个致命问题：

1. 原始数据不完整（只有~30%）
2. 缺少数据血缘关系（无法追溯）
3. 大量重复数据（无去重机制）
4. 数据源不足（只有3个）

这些问题导致数据采集功能根本无法使用，必须彻底重构。

### Q2: 重构周期为什么是9周？

**A**:

- Week 1-2: 基础架构（最重要，必须扎实）
- Week 3-4: 数据源扩展（5个新爬虫）
- Week 5: 任务调度（BullMQ集成）
- Week 6: 质量保障（评分和检测）
- Week 7-8: UI开发（6个页面）
- Week 9: 测试上线（确保稳定）

考虑到测试和优化，9周是合理的工期。

### Q3: 如何保证数据不丢失？

**A**:

1. **MongoDB存储100%原始数据**（完整的API响应或HTML）
2. **双向引用机制**（PostgreSQL ↔ MongoDB）
3. **每日全量备份** + Oplog增量备份
4. **数据一致性检查脚本**（定期修复）

### Q4: 去重准确率如何保证 >98%？

**A**:

1. **4层去重机制**（URL、标题、内容、作者+时间）
2. **可配置阈值**（根据实际情况调整）
3. **人工验证反馈**（持续优化算法）
4. **测试驱动开发**（标注测试集验证）

### Q5: 如何应对反爬虫？

**A**:

1. User-Agent轮换（10+个）
2. 请求延迟和限速
3. 代理池（可选）
4. Playwright处理动态网页
5. 尊重robots.txt和API限额

---

## 📞 联系方式

| 角色       | 负责人 | 联系方式 |
| ---------- | ------ | -------- |
| 产品负责人 | TBD    | -        |
| 技术负责人 | TBD    | -        |
| 项目经理   | TBD    | -        |
| 后端开发   | TBD    | -        |
| 前端开发   | TBD    | -        |
| 测试工程师 | TBD    | -        |

---

## 📝 更新日志

| 日期       | 版本 | 更新内容                   | 作者   |
| ---------- | ---- | -------------------------- | ------ |
| 2025-11-21 | v1.0 | 初始版本，创建所有核心文档 | Claude |

---

**文档状态**: ✅ 已完成，待审阅
**下次审阅**: 2025-11-25（项目启动会）
